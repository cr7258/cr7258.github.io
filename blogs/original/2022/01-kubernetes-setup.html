<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubenetes 高可用集群搭建 | Se7en的架构笔记</title>
    <meta name="description" content="个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。">
    <meta name="generator" content="VitePress v1.0.0-rc.31">
    <link rel="preload stylesheet" href="/assets/style.9FIl3OVA.css" as="style">
    
    <script type="module" src="/assets/app.BpdwiwgT.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.FHZ5yb6k.js">
    <link rel="modulepreload" href="/assets/chunks/theme.xmvugTu9.js">
    <link rel="modulepreload" href="/assets/chunks/md5.0oexlRJv.js">
    <link rel="modulepreload" href="/assets/chunks/use-popup-manager.3ZIgUJdU.js">
    <link rel="modulepreload" href="/assets/chunks/DirectoryList.3hVNaxu4.js">
    <link rel="modulepreload" href="/assets/chunks/ArticleMetadata.Yw6SSleQ.js">
    <link rel="modulepreload" href="/assets/blogs_original_2022_01-kubernetes-setup.md.o1jFd3Dg.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="author" content="Se7en">
    <meta name="keywords" content="Se7en的架构笔记, 知识库, 博客, Se7en">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#3c8772">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="Se7en的架构笔记">
    <meta property="og:description" content="个人技术知识库，记录 &amp; 分享个人碎片化、结构化、体系化的技术知识内容。">
    <meta property="og:site" content="https://blog.charles7c.top">
    <meta property="og:site_name" content="Se7en的架构笔记">
    <meta property="og:image" content="https://blog.charles7c.top/logo.jpg">
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?53af4b1a12fbe40810ca7ad39f8db9c7";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-03322d68><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c4918e4e></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c4918e4e> Skip to content </a><!--]--><!----><header class="VPNav" data-v-03322d68 data-v-629c70bd><div class="VPNavBar has-sidebar" data-v-629c70bd data-v-1d72176a><div class="container" data-v-1d72176a><div class="title" data-v-1d72176a><div class="VPNavBarTitle has-sidebar" data-v-1d72176a data-v-21327bbd><a class="title" href="/" data-v-21327bbd><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-d7b35c78><!--]--><!--[-->Se7en的架构笔记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-1d72176a><div class="curtain" data-v-1d72176a></div><div class="content-body" data-v-1d72176a><!--[--><!--]--><div class="VPNavBarSearch search" data-v-1d72176a><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1d72176a data-v-a12edbe3><span id="main-nav-aria-label" class="visually-hidden" data-v-a12edbe3>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a12edbe3 data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><!----><span data-v-f18e2dbf>Meetup</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><div class="items" data-v-8a7fe2f1><!--[--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/meetup/network/index" data-v-cf652a9b><!--[-->网络<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-a12edbe3 data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><!----><span data-v-f18e2dbf>博客</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><div class="items" data-v-8a7fe2f1><!--[--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link active" href="/blogs/original/index" data-v-cf652a9b><!--[-->原创<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/blogs/translate/index" data-v-cf652a9b><!--[-->翻译<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a12edbe3 data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><!----><span data-v-f18e2dbf>我的分类</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><div class="items" data-v-8a7fe2f1><!--[--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/categories/issues/index" data-v-cf652a9b><!--[-->Bug万象集<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/categories/fragments/index" data-v-cf652a9b><!--[-->个人速查手册<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/categories/tools/index" data-v-cf652a9b><!--[-->精选工具箱<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/categories/open-source/index" data-v-cf652a9b><!--[-->开源项目<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/categories/learning/index" data-v-cf652a9b><!--[-->学习笔记<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a12edbe3 data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><!----><span data-v-f18e2dbf>我的小册</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><div class="items" data-v-8a7fe2f1><!--[--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/courses/elastic-stack/index" data-v-cf652a9b><!--[-->Elastic Stack 实战教程<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/courses/interview/index" data-v-cf652a9b><!--[-->面试宝典<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/courses/algorithm/index" data-v-cf652a9b><!--[-->数据结构与算法<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tags" tabindex="0" data-v-a12edbe3 data-v-bc587c79><!--[--><span data-v-bc587c79>我的标签</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/archives" tabindex="0" data-v-a12edbe3 data-v-bc587c79><!--[--><span data-v-bc587c79>我的归档</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a12edbe3 data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><!----><span data-v-f18e2dbf>关于</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><div class="items" data-v-8a7fe2f1><!--[--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/about/index" data-v-cf652a9b><!--[-->关于知识库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8a7fe2f1 data-v-cf652a9b><a class="VPLink link" href="/about/me" data-v-cf652a9b><!--[-->关于我<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-1d72176a data-v-b9e77edf data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-f18e2dbf><span class="text" data-v-f18e2dbf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-f18e2dbf><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f18e2dbf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><!----><!--[--><!--[--><div class="items" data-v-b9e77edf><p class="title" data-v-b9e77edf>中文</p><!--[--><div class="VPMenuLink" data-v-b9e77edf data-v-cf652a9b><a class="VPLink link" href="/en/blogs/original/2022/01-kubernetes-setup" data-v-cf652a9b><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-1d72176a data-v-c2c90abb><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-c2c90abb data-v-1502017d data-v-54e1997a><span class="check" data-v-54e1997a><span class="icon" data-v-54e1997a><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1502017d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1502017d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-1d72176a data-v-804ae77e data-v-f57dd261><!--[--><a class="VPSocialLink no-icon" href="https://github.com/cr7258/cr7258.github.io" aria-label="github" target="_blank" rel="noopener" data-v-f57dd261 data-v-19217157><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-1d72176a data-v-3893c6ae data-v-f18e2dbf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-f18e2dbf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-f18e2dbf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-f18e2dbf><div class="VPMenu" data-v-f18e2dbf data-v-8a7fe2f1><!----><!--[--><!--[--><div class="group translations" data-v-3893c6ae><p class="trans-title" data-v-3893c6ae>中文</p><!--[--><div class="VPMenuLink" data-v-3893c6ae data-v-cf652a9b><a class="VPLink link" href="/en/blogs/original/2022/01-kubernetes-setup" data-v-cf652a9b><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-3893c6ae><div class="item appearance" data-v-3893c6ae><p class="label" data-v-3893c6ae>切换日光/暗黑模式</p><div class="appearance-action" data-v-3893c6ae><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-3893c6ae data-v-1502017d data-v-54e1997a><span class="check" data-v-54e1997a><span class="icon" data-v-54e1997a><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1502017d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1502017d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-3893c6ae><div class="item social-links" data-v-3893c6ae><div class="VPSocialLinks social-links-list" data-v-3893c6ae data-v-f57dd261><!--[--><a class="VPSocialLink no-icon" href="https://github.com/cr7258/cr7258.github.io" aria-label="github" target="_blank" rel="noopener" data-v-f57dd261 data-v-19217157><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1d72176a data-v-a6ca9ab6><span class="container" data-v-a6ca9ab6><span class="top" data-v-a6ca9ab6></span><span class="middle" data-v-a6ca9ab6></span><span class="bottom" data-v-a6ca9ab6></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-03322d68 data-v-b9e3214b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b9e3214b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b9e3214b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b9e3214b>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b9e3214b data-v-06057024><button data-v-06057024>返回顶部</button><!----></div></div><aside class="VPSidebar" data-v-03322d68 data-v-802ad7d8><div class="curtain" data-v-802ad7d8></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-802ad7d8><span class="visually-hidden" id="sidebar-aria-label" data-v-802ad7d8> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-802ad7d8><section class="VPSidebarItem level-0 collapsible" data-v-802ad7d8 data-v-95d837d1><div class="item" role="button" tabindex="0" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><h2 class="text" data-v-95d837d1><img class="chinese-zodiac" style="position: static; vertical-align: middle; padding-bottom: 3px;" src="/img/svg/chinese-zodiac/snake.svg" title="蛇年" alt="生肖">
            2025年 (1篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-95d837d1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-95d837d1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-95d837d1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2025/01-mcp" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>一文带你入门 MCP（模型上下文协议）</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-802ad7d8><section class="VPSidebarItem level-0 collapsible" data-v-802ad7d8 data-v-95d837d1><div class="item" role="button" tabindex="0" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><h2 class="text" data-v-95d837d1><img class="chinese-zodiac" style="position: static; vertical-align: middle; padding-bottom: 3px;" src="/img/svg/chinese-zodiac/dragon.svg" title="龙年" alt="生肖">
            2024年 (3篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-95d837d1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-95d837d1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-95d837d1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2024/03-higress-ai-plugins" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>使用 Higress AI 插件对接通义千问大语言模型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2024/02-sidecar-containers" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>深入剖析 Kubernetes 原生 Sidecar 容器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2024/01-crossplane" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>Crossplane 实战：构建统一的云原生控制平面</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-802ad7d8><section class="VPSidebarItem level-0 collapsible" data-v-802ad7d8 data-v-95d837d1><div class="item" role="button" tabindex="0" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><h2 class="text" data-v-95d837d1><img class="chinese-zodiac" style="position: static; vertical-align: middle; padding-bottom: 3px;" src="/img/svg/chinese-zodiac/rabbit.svg" title="兔年" alt="生肖">
            2023年 (10篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-95d837d1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-95d837d1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-95d837d1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/10-cilium-bgp" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>使用 Containerlab + Kind 快速部署 Cilium BGP 环境</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/09-clusterresourceset" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>使用 ClusterResourceSet 为 Cluster API 集群自动安装 CNI 插件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/08-cilium-cluster-mesh" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>Cilium 多集群 Cluster Mesh 介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/07-vcluster" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>vCluster -- 基于虚拟集群的多租户方案</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/06-kubernetes-multi-cluster-2" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>Kubernetes 多集群网络方案系列 2 -- Submariner 监控</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/05-kubernetes-multi-cluster-1" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>Kubernetes 多集群网络方案系列 1 -- Submariner 介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/04-kubernetes-keycloak-oidc" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">7</div>在 Kubernetes 中使用 Keycloak OIDC Provider 对用户进行身份验证</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/03-kubectl-patch" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">8</div>使用 Kubectl Patch 命令更新资源</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/02-wasm-in-cloud-native" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">9</div>WebAssembly 在云原生中的实践指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2023/01-argocd-quickstart" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">10</div>ArgoCD 简明教程</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-802ad7d8><section class="VPSidebarItem level-0 collapsible" data-v-802ad7d8 data-v-95d837d1><div class="item" role="button" tabindex="0" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><h2 class="text" data-v-95d837d1><img class="chinese-zodiac" style="position: static; vertical-align: middle; padding-bottom: 3px;" src="/img/svg/chinese-zodiac/tiger.svg" title="虎年" alt="生肖">
            2022年 (13篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-95d837d1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-95d837d1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-95d837d1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/13-envoy-quickstart" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>使用 Envoy 作为前端代理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/12.lru" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>实现 LRU 缓存算法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/11.nebula" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>Nebula 分布式图数据库介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/10-harbor" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>Habor 部署指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/09-pulsar" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>Pulsar 介绍与部署</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/08-reset-kafka-consumer-offset" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>如何重置 Kafka 中的 Consumer Offset？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/07-kafka-big-message" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">7</div>如何往 Kafka 发送大消息？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/06-kafka-setup" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">8</div>Kafka 生产环境部署指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/05-docker-rootless" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">9</div>Docker Rootless 在非特权模式下运行 Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/04-kubeasz" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">10</div>使用 ezctl 工具部署和管理 Kubernetes 集群</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/03-finalizer" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">11</div>Kubernetes 中的对象是如何删除的：Finalizers 字段介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/02-kubectl-debug" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">12</div>Kubectl debug 调试容器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-95d837d1 data-v-95d837d1><div class="item" data-v-95d837d1><div class="indicator" data-v-95d837d1></div><a class="VPLink link link" href="/blogs/original/2022/01-kubernetes-setup" data-v-95d837d1><!--[--><p class="text" data-v-95d837d1><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">13</div>Kubenetes 高可用集群搭建</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-03322d68 data-v-2c336b25><div class="VPDoc has-sidebar has-aside" data-v-2c336b25 data-v-53ed897c><!--[--><!--]--><div class="container" data-v-53ed897c><div class="aside" data-v-53ed897c><div class="aside-curtain" data-v-53ed897c></div><div class="aside-container" data-v-53ed897c><div class="aside-content" data-v-53ed897c><div class="VPDocAside" data-v-53ed897c data-v-3d450548><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3d450548 data-v-70b38f01><div class="content" data-v-70b38f01><div class="outline-marker" data-v-70b38f01></div><div class="outline-title" role="heading" aria-level="2" data-v-70b38f01>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-70b38f01><span class="visually-hidden" id="doc-outline-aria-label" data-v-70b38f01> Table of Contents for current page </span><ul class="root" data-v-70b38f01 data-v-e10534d6><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3d450548></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-53ed897c><div class="content-container" data-v-53ed897c><!--[--><!--]--><!----><main class="main" data-v-53ed897c><div style="position:relative;" class="vp-doc _blogs_original_2022_01-kubernetes-setup" data-v-53ed897c><div><h1 id="kubenetes-高可用集群搭建" tabindex="-1">Kubenetes 高可用集群搭建 <a class="header-anchor" href="#kubenetes-高可用集群搭建" aria-label="Permalink to &quot;Kubenetes 高可用集群搭建&quot;">​</a></h1><!----><h2 id="集群拓扑" tabindex="-1">集群拓扑 <a class="header-anchor" href="#集群拓扑" aria-label="Permalink to &quot;集群拓扑&quot;">​</a></h2><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Kubernetes/20201128223233.png" alt=""></p><h2 id="架构说明" tabindex="-1">架构说明 <a class="header-anchor" href="#架构说明" aria-label="Permalink to &quot;架构说明&quot;">​</a></h2><p>部署主要分为以下4个步骤：</p><ul><li>1.<strong>搭建外部etcd集群</strong>: etcd是kubernetes集群中的一个十分重要的组件，用于保存集群所有的网络配置和对象的状态信息。本次实验通过kubelet部署static pod方式在集群外部部署一个3节点的etcd集群。</li><li>2.<strong>负载均衡配置</strong>：haproxy为3个k8s master的apiserver提供反向代理功能，另外还是用keepalived为2个haproxy提供一个VIP（虚拟IP），当主haproxy发生故障时，VIP可以自动切换到备haproxy。</li><li>3.<strong>kubeadm部署集群</strong>：部署3 master，3 worker高可用集群。</li><li>4.<strong>部署Rancher</strong>（可选）：在kubernetes集群中安装rancher-agent，将kubeadm部署的k8s集群纳管到Rancher中。Rancher可以提供可视化管理界面。</li></ul><h2 id="ip地址规划" tabindex="-1">IP地址规划 <a class="header-anchor" href="#ip地址规划" aria-label="Permalink to &quot;IP地址规划&quot;">​</a></h2><table><thead><tr><th>IP</th><th>主机名</th><th>用途</th></tr></thead><tbody><tr><td>192.168.1.242</td><td>etcd1</td><td>etcd</td></tr><tr><td>192.168.1.243</td><td>etcd2</td><td>etcd</td></tr><tr><td>192.168.1.244</td><td>etcd3</td><td>etcd</td></tr><tr><td>192.168.1.245</td><td>master1</td><td>k8s master</td></tr><tr><td>192.168.1.246</td><td>master2</td><td>k8s master</td></tr><tr><td>192.168.1.247</td><td>master3</td><td>k8s master</td></tr><tr><td>192.168.1.248</td><td>worker1</td><td>k8s worker</td></tr><tr><td>192.168.1.249</td><td>worker2</td><td>k8s worker</td></tr><tr><td>192.168.1.250</td><td>worker3</td><td>k8s worker</td></tr><tr><td>192.168.1.251</td><td>haproxy-master</td><td>haproxy-master</td></tr><tr><td>192.168.1.252</td><td>haproxy-backup</td><td>haproxy-backup</td></tr><tr><td>192.168.1.253</td><td></td><td>k8s api-server VIP</td></tr></tbody></table><h2 id="部署操作" tabindex="-1">部署操作 <a class="header-anchor" href="#部署操作" aria-label="Permalink to &quot;部署操作&quot;">​</a></h2><h3 id="_1-etcd集群搭建" tabindex="-1">1 etcd集群搭建 <a class="header-anchor" href="#_1-etcd集群搭建" aria-label="Permalink to &quot;1 etcd集群搭建&quot;">​</a></h3><h4 id="_1-1-前提准备" tabindex="-1">1.1 前提准备 <a class="header-anchor" href="#_1-1-前提准备" aria-label="Permalink to &quot;1.1 前提准备&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#关闭selinux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;s/^SELINUX=.*/SELINUX=disabled/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/selinux/config</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#关闭swap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">swapoff</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/fstab</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#安装kubectl,kubeadm,kubelet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">repo_gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubectl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span></span></code></pre></div><h4 id="_1-2-kubelet配置" tabindex="-1">1.2 kubelet配置 <a class="header-anchor" href="#_1-2-kubelet配置" aria-label="Permalink to &quot;1.2 kubelet配置&quot;">​</a></h4><p>kubelet会根据/etc/kubernetes/manifests目录中的yaml文件拉起etcd的容器：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;"> EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /etc/systemd/system/kubelet.service.d/20-etcd-service-manager.conf</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ExecStart=</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">#  Replace &quot;systemd&quot; with the cgroup driver of your container runtime. The default value in the kubelet is &quot;cgroupfs&quot;.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ExecStart=/usr/bin/kubelet --address=127.0.0.1 --pod-manifest-path=/etc/kubernetes/manifests --cgroup-driver=cgroupfs</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Restart=always</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span></span></code></pre></div><h4 id="_1-3-创建kubeadm配置文件" tabindex="-1">1.3 创建kubeadm配置文件 <a class="header-anchor" href="#_1-3-创建kubeadm配置文件" aria-label="Permalink to &quot;1.3 创建kubeadm配置文件&quot;">​</a></h4><p>使用以下脚本为每个将要运行 etcd 成员的主机生成一个 kubeadm 配置文件：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指定etcd集群成员IP地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> HOST1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.242</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> HOST2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.243</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> HOST3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.244</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建临时目录来存储将被分发到其它主机上的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST1}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST2}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST3}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ETCDHOSTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(${HOST1} ${HOST2} ${HOST3})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">NAMES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;infra0&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;infra1&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;infra2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;${</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ETCDHOSTS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[@]}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${ETCDHOSTS[$i]}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${NAMES[$i]}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;"> EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /tmp/${HOST}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">apiVersion: &quot;kubeadm.k8s.io/v1beta2&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kind: ClusterConfiguration</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">etcd:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    local:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        serverCertSANs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        peerCertSANs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - &quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        extraArgs:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            initial-cluster: infra0=https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ETCDHOSTS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[0]}:2380,infra1=https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ETCDHOSTS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[1]}:2380,infra2=https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ETCDHOSTS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[2]}:2380</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            initial-cluster-state: new</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            name: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            listen-peer-urls: https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}:2380</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            listen-client-urls: https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}:2379</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            advertise-client-urls: https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}:2379</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            initial-advertise-peer-urls: https://${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}:2380</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">done</span></span></code></pre></div><h4 id="_1-4-生成证书颁发机构" tabindex="-1">1.4 生成证书颁发机构 <a class="header-anchor" href="#_1-4-生成证书颁发机构" aria-label="Permalink to &quot;1.4 生成证书颁发机构&quot;">​</a></h4><p>在HOST1（192.168.1.242）主机上生成证书颁发机构：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-ca</span></span></code></pre></div><p>创建了如下两个文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">/etc/kubernetes/pki/etcd/ca.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">/etc/kubernetes/pki/etcd/ca.key</span></span></code></pre></div><p>复制 CA 的 crt 和 key 文件到 etc/kubernetes/pki/etcd/ca.crt 和 /etc/kubernetes/pki/etcd/ca.key。</p><h4 id="_1-5-为每个成员创建证书" tabindex="-1">1.5 为每个成员创建证书 <a class="header-anchor" href="#_1-5-为每个成员创建证书" aria-label="Permalink to &quot;1.5 为每个成员创建证书&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-peer</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-healthcheck-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/kubernetes/pki</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST3}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 清理不可重复使用的证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/kubernetes/pki</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -not</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -not</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-peer</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-healthcheck-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/kubernetes/pki</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST2}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/kubernetes/pki</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -not</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.crt</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -not</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-peer</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd-healthcheck-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> phase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --config=/tmp/${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST1}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/kubeadmcfg.yaml</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  /etc/kubernetes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 不需要移动 certs 因为它们是给 HOST1 使用的</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 清理不应从此主机复制的证书</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST3} </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${HOST2} </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> f</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -delete</span></span></code></pre></div><h4 id="_1-6-复制证书和kubeadm配置文件到其他两个etcd节点" tabindex="-1">1.6 复制证书和kubeadm配置文件到其他两个etcd节点 <a class="header-anchor" href="#_1-6-复制证书和kubeadm配置文件到其他两个etcd节点" aria-label="Permalink to &quot;1.6 复制证书和kubeadm配置文件到其他两个etcd节点&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>scp -r /tmp/${HOST2}/* root@${HOST2}:/etc/kubernetes</span></span>
<span class="line"><span>scp -r /tmp/${HOST3}/* root@${HOST3}:/etc/kubernetes</span></span></code></pre></div><p>确保已经所有预期的文件都存在：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@etcd1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# tree /etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">/etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manifests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pki</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> directories,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> files</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@etcd2 kubernetes]# tree /etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manifests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pki</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> directories,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> files</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@etcd3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# tree /etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">/etc/kubernetes/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadmcfg.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manifests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">│  </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pki</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver-etcd-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthcheck-client.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer.key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        ├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.crt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        └──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> directories,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> files</span></span></code></pre></div><h4 id="_1-7-生成静态pod配置文件" tabindex="-1">1.7 生成静态Pod配置文件 <a class="header-anchor" href="#_1-7-生成静态pod配置文件" aria-label="Permalink to &quot;1.7 生成静态Pod配置文件&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>[root@etcd1 ~]#  kubeadm init phase etcd local --config=/etc/kubernetes/kubeadmcfg.yaml  </span></span>
<span class="line"><span>[root@etcd2 ~]#  kubeadm init phase etcd local --config=/etc/kubernetes/kubeadmcfg.yaml  </span></span>
<span class="line"><span>[root@etcd3 ~]#  kubeadm init phase etcd local --config=/etc/kubernetes/kubeadmcfg.yaml</span></span></code></pre></div><h4 id="_1-8-检查etcd集群运行情况" tabindex="-1">1.8 检查etcd集群运行情况 <a class="header-anchor" href="#_1-8-检查etcd集群运行情况" aria-label="Permalink to &quot;1.8 检查etcd集群运行情况&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@etcd1 kubernetes]# docker run --rm -it --name etcd-check \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> --net host \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> -v /etc/kubernetes:/etc/kubernetes k8s.gcr.io/etcd:${ETCD_TAG} etcdctl \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> --cert /etc/kubernetes/pki/etcd/peer.crt \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> --key /etc/kubernetes/pki/etcd/peer.key \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> --cacert /etc/kubernetes/pki/etcd/ca.crt \</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> --endpoints https://${HOST1}:2379 endpoint health --cluster</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">https://192.168.1.244:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthy:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> committed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> proposal:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> took</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 29.827986</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">https://192.168.1.243:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthy:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> committed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> proposal:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> took</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30.169169</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">https://192.168.1.242:2379</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> healthy:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> committed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> proposal:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> took</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 31.270748</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ms</span></span></code></pre></div><h3 id="_2-负载均衡配置" tabindex="-1">2 负载均衡配置 <a class="header-anchor" href="#_2-负载均衡配置" aria-label="Permalink to &quot;2 负载均衡配置&quot;">​</a></h3><h4 id="_2-1-部署haproxy" tabindex="-1">2.1 部署haproxy <a class="header-anchor" href="#_2-1-部署haproxy" aria-label="Permalink to &quot;2.1 部署haproxy&quot;">​</a></h4><h5 id="_2-1-1-安装haproxy" tabindex="-1">2.1.1 安装haproxy <a class="header-anchor" href="#_2-1-1-安装haproxy" aria-label="Permalink to &quot;2.1.1 安装haproxy&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>yum install -y haproxy</span></span></code></pre></div><h5 id="_2-1-2-修改haproxy配置文件" tabindex="-1">2.1.2 修改haproxy配置文件 <a class="header-anchor" href="#_2-1-2-修改haproxy配置文件" aria-label="Permalink to &quot;2.1.2 修改haproxy配置文件&quot;">​</a></h5><p>vim /etc/haproxy/haproxy.cfg，两台haproxy的配置文件是一致的。</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Example configuration for a possible web application.  See the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># full configuration options online.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#   http://haproxy.1wt.eu/download/1.4/doc/configuration.txt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Global settings</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">global</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    # to have these messages end up in /var/log/haproxy.log you will</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    # need to:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    # 1) configure syslog to accept network log events.  This is done</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #    by adding the &#39;-r&#39; option to the SYSLOGD_OPTIONS in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #    /etc/sysconfig/syslog</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    # 2) configure local2 events to go to the /var/log/haproxy.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #   file. A line like the following can be added to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #   /etc/sysconfig/syslog</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #    local2.*                       /var/log/haproxy.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    log</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">         127.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> local2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    chroot</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      /var/lib/haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     /var/run/haproxy.pid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    maxconn</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">     4000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    user</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       haproxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    daemon</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    # turn on stats unix socket</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    stats</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> socket</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/lib/haproxy/stats</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># common defaults that all the &#39;listen&#39; and &#39;backend&#39; sections will</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># use if not designated in their block</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">defaults</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                    http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    log</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                     global</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  httplog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  dontlognull</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http-server-close</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forwardfor</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       except</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.0/8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  redispatch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    retries</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">                 3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http-request</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> queue</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">           1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> connect</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">         10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">          1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">          1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">m</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http-keep-alive</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">           10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    maxconn</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">                 3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># main frontend which proxys to the backends</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">frontend</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:6443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tcplog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    default_backend</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># static backend for serving up images, stylesheets and such</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#---------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">backend</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apiserver</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> httpchk</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> GET</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /healthz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    http-check</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> expect</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ssl-hello-chk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    balance</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  roundrobin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #server为三个k8s master的地址:端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  master1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.245:6443</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  master2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.246:6443</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  master3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.247:6443</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check</span></span></code></pre></div><h5 id="_2-1-3-启动haproxy" tabindex="-1">2.1.3 启动haproxy <a class="header-anchor" href="#_2-1-3-启动haproxy" aria-label="Permalink to &quot;2.1.3 启动haproxy&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>systemctl enable haproxy --now</span></span></code></pre></div><h4 id="_2-2-部署keepalived" tabindex="-1">2.2 部署keepalived <a class="header-anchor" href="#_2-2-部署keepalived" aria-label="Permalink to &quot;2.2 部署keepalived&quot;">​</a></h4><h5 id="_2-2-1-安装keepalived" tabindex="-1">2.2.1 安装keepalived <a class="header-anchor" href="#_2-2-1-安装keepalived" aria-label="Permalink to &quot;2.2.1 安装keepalived&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>yum install -y keepalived</span></span></code></pre></div><h5 id="_2-2-2-修改keepalived配置文件" tabindex="-1">2.2.2 修改keepalived配置文件 <a class="header-anchor" href="#_2-2-2-修改keepalived配置文件" aria-label="Permalink to &quot;2.2.2 修改keepalived配置文件&quot;">​</a></h5><p>vim /etc/keepalived/keepalived.conf keepalived master配置文件：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">global_defs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    router_id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LVS_DEVEL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vrrp_script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check_apiserver</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  weight</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  fall</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  rise</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vrrp_instance</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> VI_1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MASTER</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #Master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    interface</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ens192</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    virtual_router_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 51</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #主备的router_id保存一致</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 101</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   #Master的优先级要高于Backup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    authentication</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        auth_type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PASS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        auth_pass</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 42</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #主备的auth_pass保存一致</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    virtual_ipaddress</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        192.168.1.253</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #VIP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    track_script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        check_apiserver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>keepalived backup配置文件：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">global_defs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    router_id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LVS_DEVEL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vrrp_script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> check_apiserver</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  interval</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  weight</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  fall</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  rise</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vrrp_instance</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> VI_1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> BACKUP</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #BACKUP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    interface</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ens192</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    virtual_router_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 51</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #主备的router_id保存一致</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #Master的优先级要高于Backup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    authentication</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        auth_type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PASS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        auth_pass</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 42</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #主备的auth_pass保存一致</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    virtual_ipaddress</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        192.168.1.253</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  #VIP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    track_script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        check_apiserver</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h5 id="_2-2-3-编辑健康检查脚本" tabindex="-1">2.2.3 编辑健康检查脚本 <a class="header-anchor" href="#_2-2-3-编辑健康检查脚本" aria-label="Permalink to &quot;2.2.3 编辑健康检查脚本&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>#!/bin/sh</span></span>
<span class="line"><span></span></span>
<span class="line"><span>errorExit() {</span></span>
<span class="line"><span>    echo &quot;*** $*&quot; 1&gt;&amp;2</span></span>
<span class="line"><span>    exit 1</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>curl --silent --max-time 2 --insecure https://localhost:6443/ -o /dev/null || errorExit &quot;Error GET https://localhost:6443/&quot;</span></span>
<span class="line"><span>if ip addr | grep -q 192.168.1.253; then</span></span>
<span class="line"><span>    curl --silent --max-time 2 --insecure https://192.168.1.253:6443/ -o /dev/null || errorExit &quot;Error GET https://192.168.1.253:6443/&quot;</span></span>
<span class="line"><span>fi</span></span></code></pre></div><h5 id="_2-2-4-启动keepalived" tabindex="-1">2.2.4 启动keepalived <a class="header-anchor" href="#_2-2-4-启动keepalived" aria-label="Permalink to &quot;2.2.4 启动keepalived&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>systemctl enable keepalived --now</span></span></code></pre></div><h3 id="_3-kubeadm部署集群" tabindex="-1">3 kubeadm部署集群 <a class="header-anchor" href="#_3-kubeadm部署集群" aria-label="Permalink to &quot;3 kubeadm部署集群&quot;">​</a></h3><h4 id="_3-1-前提准备" tabindex="-1">3.1 前提准备 <a class="header-anchor" href="#_3-1-前提准备" aria-label="Permalink to &quot;3.1 前提准备&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#关闭selinux</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;s/^SELINUX=.*/SELINUX=disabled/&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/selinux/config</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#关闭swap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">swapoff</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/fstab</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#安装kubectl,kubeadm,kubelet</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">repo_gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubectl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubelet</span></span></code></pre></div><h4 id="_3-2-初始化集群" tabindex="-1">3.2 初始化集群 <a class="header-anchor" href="#_3-2-初始化集群" aria-label="Permalink to &quot;3.2 初始化集群&quot;">​</a></h4><p>kubeadm初始化yaml文件：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ClusterConfiguration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kubernetesVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">stable</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">controlPlaneEndpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.1.253:6443&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #haproxy的keepalived提供的VIP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">etcd</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    external</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">https://192.168.1.242:2379</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">https://192.168.1.243:2379</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">https://192.168.1.244:2379</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        caFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/etc/kubernetes/pki/etcd/ca.crt</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        certFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/etc/kubernetes/pki/apiserver-etcd-client.crt</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        keyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/etc/kubernetes/pki/apiserver-etcd-client.key</span></span></code></pre></div><p>执行初始化命令：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#--upload-certs命令用于分发证书到其他控制节点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@master1 kubernetes]# kubeadm init --config kubeadm-config.yaml --upload-certs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">W1125</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:28:56.393074</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   13988</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configset.go:348]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> WARNING:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> validate</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> component</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> groups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [kubelet.config.k8s.io </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kubeproxy.config.k8s.io]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[init] Using Kubernetes version: v1.19.4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[preflight] Running pre-flight checks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        [WARNING IsDockerSystemdCheck]</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> detected</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;cgroupfs&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cgroup</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> driver.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> recommended</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> driver</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;systemd&quot;.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Please</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> follow</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> guide</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://kubernetes.io/docs/setup/cri/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[preflight] Pulling images required </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> setting up a Kubernetes cluster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[preflight] This might take a minute or two, depending on the speed of your internet connection</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[preflight] You can also perform this action </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> beforehand using </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;kubeadm config images pull&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Using certificateDir folder </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/etc/kubernetes/pki&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ca&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;apiserver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] apiserver serving cert is signed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local master1] and IPs [</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10.96</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.0.1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.1.245 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.1.253]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;apiserver-kubelet-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;front-proxy-ca&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;front-proxy-client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] External etcd mode: Skipping etcd/ca certificate authority generation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] External etcd mode: Skipping etcd/server certificate generation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] External etcd mode: Skipping etcd/peer certificate generation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] External etcd mode: Skipping etcd/healthcheck-client certificate generation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] External etcd mode: Skipping apiserver-etcd-client certificate generation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[certs] Generating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;sa&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> key and public key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubeconfig] Using kubeconfig folder </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/etc/kubernetes&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubeconfig] Writing </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;admin.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubeconfig file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubeconfig] Writing </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kubelet.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubeconfig file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubeconfig] Writing </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;controller-manager.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubeconfig file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubeconfig] Writing </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;scheduler.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubeconfig file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubelet-start] Writing kubelet environment file with flags to file </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubelet-start] Writing kubelet configuration to file </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/var/lib/kubelet/config.yaml&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubelet-start] Starting the kubelet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[control-plane] Using manifest folder </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/etc/kubernetes/manifests&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[control-plane] Creating static Pod manifest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;kube-apiserver&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[control-plane] Creating static Pod manifest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;kube-controller-manager&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[control-plane] Creating static Pod manifest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;kube-scheduler&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[wait-control-plane] Waiting </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the kubelet to boot up the control plane as static Pods from directory </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/etc/kubernetes/manifests&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">. This can take up to 4m0s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[apiclient] All control plane components are healthy after 22.048332 seconds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[upload-config] Storing the configuration used </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ConfigMap </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kubeadm-config&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kube-system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Namespace</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubelet] Creating a ConfigMap </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kubelet-config-1.19&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> namespace kube-system with the configuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the kubelets </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the cluster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[upload-certs] Storing the certificates </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Secret </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kubeadm-certs&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kube-system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Namespace</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[upload-certs] Using certificate key:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">467b45aac2ebf12a6bd88d71abc91e6628698b5310529b83f9c8a8b5ec7831e6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[mark-control-plane] Marking the node master1 as control-plane by adding the label </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;node-role.kubernetes.io/master=&#39;&#39;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[mark-control-plane] Marking the node master1 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] Using token: d0idxe.5qepodyefo6ohfey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> order </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> nodes to get long term certificate credentials</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] configured RBAC rules to allow certificate rotation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> all node client certificates </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the cluster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[bootstrap-token] Creating the </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;cluster-info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ConfigMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> the </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kube-public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> namespace</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[kubelet-finalize] Updating </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/etc/kubernetes/kubelet.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> to point to a rotatable kubelet client certificate and key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[addons] Applied essential addon: CoreDNS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[addons] Applied essential addon: kube-proxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initialized</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> successfully!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">To</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> using</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cluster,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> need</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> regular</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> user:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/.kube</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/kubernetes/admin.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">):$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> should</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> now</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pod</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cluster.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;kubectl apply -f [podnetwork].yaml&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> one</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> options</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> listed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> can</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> now</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> any</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> control-plane</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> command</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> each</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> root:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.253:6443</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --token</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> d0idxe.5qepodyefo6ohfey</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256:2e864b2742535b83090b51416290d5b48cebe7b2d7b487c273e5e1bfe6248cca</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --control-plane</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --certificate-key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 467</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">b45aac2ebf12a6bd88d71abc91e6628698b5310529b83f9c8a8b5ec7831e6</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Please</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> note</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certificate-key</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gives</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> access</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sensitive</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> data,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> keep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> secret!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">As</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safeguard,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> uploaded-certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> will</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deleted</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> two</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hours</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> necessary,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> can</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;kubeadm init phase upload-certs --upload-certs&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> certs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> afterward.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Then</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> can</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> any</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> worker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nodes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> each</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> root:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.253:6443</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --token</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> d0idxe.5qepodyefo6ohfey</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256:2e864b2742535b83090b51416290d5b48cebe7b2d7b487c273e5e1bfe6248cca</span></span></code></pre></div><h4 id="_3-3-加入新的master节点" tabindex="-1">3.3 加入新的master节点 <a class="header-anchor" href="#_3-3-加入新的master节点" aria-label="Permalink to &quot;3.3 加入新的master节点&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.253:6443</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --token</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> d0idxe.5qepodyefo6ohfey</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256:2e864b2742535b83090b51416290d5b48cebe7b2d7b487c273e5e1bfe6248cca</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --control-plane</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --certificate-key</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 467</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">b45aac2ebf12a6bd88d71abc91e6628698b5310529b83f9c8a8b5ec7831e6</span></span></code></pre></div><h4 id="_3-4-加入新的worker节点" tabindex="-1">3.4 加入新的worker节点 <a class="header-anchor" href="#_3-4-加入新的worker节点" aria-label="Permalink to &quot;3.4 加入新的worker节点&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubeadm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.253:6443</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --token</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> d0idxe.5qepodyefo6ohfey</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256:2e864b2742535b83090b51416290d5b48cebe7b2d7b487c273e5e1bfe6248cca</span></span></code></pre></div><h4 id="_3-5-查看创建完的集群" tabindex="-1">3.5 查看创建完的集群 <a class="header-anchor" href="#_3-5-查看创建完的集群" aria-label="Permalink to &quot;3.5 查看创建完的集群&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@master1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# kubectl get node -o wide</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   INTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   OS-IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                KERNEL-VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          CONTAINER-RUNTIME</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    master</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d8h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.245</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    master</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d6h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.246</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    master</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d6h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.247</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">worker1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.248</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">worker2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.249</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">worker3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">d5h</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   v1.19.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.250</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Linux</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Core)   3.10.0-693.el7.x86_64   docker://18.9.4</span></span></code></pre></div><h3 id="_4-部署rancher" tabindex="-1">4 部署Rancher <a class="header-anchor" href="#_4-部署rancher" aria-label="Permalink to &quot;4 部署Rancher&quot;">​</a></h3><h4 id="_4-1-安装rancher" tabindex="-1">4.1 安装Rancher <a class="header-anchor" href="#_4-1-安装rancher" aria-label="Permalink to &quot;4.1 安装Rancher&quot;">​</a></h4><p>本次实验Rancher部署在k8s集群中，需要另外搭建一个k8s集群用于部署Rancher，这里跳过搭建k8s集群的步骤。 通过helm部署Rancher：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rancher-latest</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://releases.rancher.com/server-charts/rancher-latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rancher</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rancher-latest/rancher</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cattle-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hostname=www.chengzw.top</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #安装完成后，修改cattle-system命名空间中名为rancher的service的模式为NodePort，方便我们在集群外部访问Rancher</span></span></code></pre></div><h4 id="_4-2-部署nginx-ssl卸载-可选" tabindex="-1">4.2 部署Nginx SSL卸载（可选） <a class="header-anchor" href="#_4-2-部署nginx-ssl卸载-可选" aria-label="Permalink to &quot;4.2 部署Nginx SSL卸载（可选）&quot;">​</a></h4><p>部署一台nginx用于反向代理Rancher：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    worker_connections </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">1024;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #Rancher http NodePort地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> rancher </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> 192.168.1.228:32284;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> 192.168.1.229:32284;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> 192.168.1.230:32284;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    map</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">http_upgrade</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $connection_upgrade {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        default</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Upgrade;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      close;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        listen </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">443 ssl http2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">www.chengzw.top;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        #提前导入www.chengzw.top证书和私钥到指定目录</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/root/cert/chengzwtop_2020.crt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/root/cert/chengzwtop_2020.key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            #注意：如果存在此标头，则rancher/rancher不会将 HTTP 重定向到 HTTPS。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">X-Forwarded-Port $server_port;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http://rancher;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Connection $connection_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_http_version </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">1.1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            # This allows the ability for the execute sh window to remain open for up to 15 minutes. Without this parameter, the default is 1 minute and will automatically close.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_read_timeout </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">900s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            proxy_buffering </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">off;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        listen </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">80;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">www.chengzw.top;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> https://$server_name$request_uri;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h4 id="_4-3-导入kubernetes集群" tabindex="-1">4.3 导入Kubernetes集群 <a class="header-anchor" href="#_4-3-导入kubernetes集群" aria-label="Permalink to &quot;4.3 导入Kubernetes集群&quot;">​</a></h4><p>在rancher页面点击添加集群--&gt;导入，下载提供的yaml文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>wget https://www.chengzw.top/v3/import/cdvk6hs4bt7kcdxnrplpnf9sbw2gpjzshzxbgxs854d6t9f8lscp29.yaml</span></span></code></pre></div><p>修改cattle-cluster-agent的yaml文件，添加hostAlias指定Pod的host记录，否则Pod会去根据DNS去解析www.chengzw.top（计算宿主机写了host记录也没用，我们这里内部要解析到nginx上，如果用DNS解析会解析到公网上）。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-cluster-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-cluster-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-cluster-agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      affinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        nodeAffinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          requiredDuringSchedulingIgnoredDuringExecution</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            nodeSelectorTerms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">              - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">matchExpressions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">beta.kubernetes.io/os</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                  operator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">NotIn</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                  values</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">windows</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          preferredDuringSchedulingIgnoredDuringExecution</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            preference</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              matchExpressions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">              - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">node-role.kubernetes.io/controlplane</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                operator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">In</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                values</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            preference</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              matchExpressions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">              - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">node-role.kubernetes.io/etcd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                operator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">In</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                values</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      serviceAccountName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      tolerations</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">operator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Exists</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">      #为cattle-cluster-agent添加host记录</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      hostAliases</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">ip</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.1.231&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        hostnames</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;www.chengzw.top&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cluster-register</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          imagePullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">IfNotPresent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          env</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_FEATURES</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_IS_RKE</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;false&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_SERVER</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://www.chengzw.top&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_CA_CHECKSUM</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_CLUSTER</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CATTLE_K8S_MANAGED</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rancher/rancher-agent:v2.5.3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          volumeMounts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-credentials</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/cattle-credentials</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            readOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-credentials</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        secret</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          secretName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cattle-credentials-049e86b</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          defaultMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">320</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">...</span></span></code></pre></div><p>我们这里使用的证书是在阿里云上申请的受信任的证书，如果是自签名证书需要注意要将ca证书导入rancher-agent：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #自签名证书需要添加ca.crt到cattle-cluster-agent内部</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rancher-certs</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/etc/kubernetes/ssl/certs/ca.crt</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  subPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ca.crt</span></span></code></pre></div><h4 id="_4-4-访问rancher管理界面" tabindex="-1">4.4 访问Rancher管理界面 <a class="header-anchor" href="#_4-4-访问rancher管理界面" aria-label="Permalink to &quot;4.4 访问Rancher管理界面&quot;">​</a></h4><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Kubernetes/20210103152811.png" alt=""></p></div></div></main><footer class="VPDocFooter" data-v-53ed897c data-v-f3af8004><!--[--><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-f3af8004><div class="edit-link" data-v-f3af8004><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/cr7258/cr7258.github.io/edit/main/docs/blogs/original/2022/01-kubernetes-setup.md" target="_blank" rel="noreferrer" data-v-f3af8004><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-f3af8004><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 不妥之处，敬请雅正<!--]--></a></div><div class="last-updated" data-v-f3af8004><p class="VPLastUpdated" data-v-f3af8004 data-v-a25eb6f3>最后更新: <time datetime="2024-02-06T13:56:38.000Z" data-v-a25eb6f3></time></p></div></div><nav class="prev-next" data-v-f3af8004><div class="pager" data-v-f3af8004><!----></div><div class="pager" data-v-f3af8004><a class="VPLink link pager-link next" href="/blogs/original/2025/01-mcp" data-v-f3af8004><!--[--><span class="desc" data-v-f3af8004>下一篇</span><span class="title" data-v-f3af8004><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>一文带你入门 MCP（模型上下文协议）</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div id="comment-container"></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"archives.md\":\"gaaWfWzQ\",\"about_me.md\":\"NRnPyPRg\",\"about_index.md\":\"mofEMKrn\",\"blogs_original_2022_01-kubernetes-setup.md\":\"o1jFd3Dg\",\"blogs_original_2022_02-kubectl-debug.md\":\"b_e9DxlA\",\"blogs_original_2022_05-docker-rootless.md\":\"D6amtUIl\",\"blogs_original_2022_03-finalizer.md\":\"taIp7T9m\",\"blogs_original_2022_04-kubeasz.md\":\"ymqcuymv\",\"blogs_original_2022_08-reset-kafka-consumer-offset.md\":\"3MKVq0zm\",\"blogs_original_2022_06-kafka-setup.md\":\"TC2BaGw-\",\"blogs_original_2022_07-kafka-big-message.md\":\"e9Z7e4x8\",\"blogs_original_2022_09-pulsar.md\":\"O-W_3u5D\",\"blogs_original_2023_01-argocd-quickstart.md\":\"FXUEF49V\",\"blogs_original_2022_10-harbor.md\":\"_HZVhkB1\",\"blogs_original_2022_12.lru.md\":\"eq_yGdxR\",\"blogs_original_2023_09-clusterresourceset.md\":\"Nsf5iDGd\",\"blogs_original_2022_13-envoy-quickstart.md\":\"LPqXBaRb\",\"blogs_original_2023_04-kubernetes-keycloak-oidc.md\":\"Vq-IEgPg\",\"blogs_original_2023_07-vcluster.md\":\"mlU5tjFv\",\"blogs_original_2023_05-kubernetes-multi-cluster-1.md\":\"ZhjR5u57\",\"blogs_original_2023_03-kubectl-patch.md\":\"QS9ngpYJ\",\"blogs_original_2022_11.nebula.md\":\"POba8OvP\",\"blogs_original_2023_06-kubernetes-multi-cluster-2.md\":\"Y5-aGP3X\",\"blogs_original_2023_08-cilium-cluster-mesh.md\":\"G2yMcND6\",\"blogs_original_2023_02-wasm-in-cloud-native.md\":\"zVAOQ-py\",\"blogs_original_2023_10-cilium-bgp.md\":\"EcchVFxh\",\"blogs_translate_index.md\":\"Ybv37is9\",\"blogs_translate_2023_05-git-cheat-sheet-1.md\":\"zRHcoHNg\",\"blogs_original_index.md\":\"Rex5H7j3\",\"courses_interview_操作系统_01-cpu.md\":\"z4r8jAO8\",\"categories_learning_云原生_01-istio.md\":\"DpmO6XDp\",\"categories_learning_云原生_02-observability.md\":\"19ldFN2M\",\"categories_learning_云原生_03-ebpf.md\":\"h6kVTgQs\",\"categories_learning_编程语言_01-rust.md\":\"yBmdkj7U\",\"categories_open-source_开源项目_01-ai.md\":\"8C7_vOWc\",\"categories_tools_index.md\":\"lvIdMu9U\",\"courses_algorithm_index.md\":\"o-XruxMn\",\"courses_elastic-stack_index.md\":\"NIcR1nZ6\",\"courses_interview_ai_01-ai.md\":\"Kjrwxhes\",\"courses_interview_elastic stack_01-elasticsearch.md\":\"BiXwwkYc\",\"courses_interview_index.md\":\"7UU36vTo\",\"categories_tools_编程工具_01-windsurf.md\":\"IAGsTqIW\",\"categories_learning_ ai_03-pytorch.md\":\"E-3y4sSQ\",\"index.md\":\"M2mpGzWe\",\"categories_learning_index.md\":\"nbCNSNoR\",\"categories_tools_云原生_01-k8s-resource.md\":\"a2Qaf317\",\"blogs_translate_2023_01-life-of-a-packet-in-kubernetes-part-1.md\":\"2MbeCIgq\",\"courses_interview_云原生_04-network.md\":\"dIGxBP-E\",\"blogs_original_2025_01-mcp.md\":\"53UVseh1\",\"categories_fragments_index.md\":\"HbQVDBKo\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_04-fleet.md\":\"39Yq-dXS\",\"en_courses_elastic-stack_index.md\":\"klxhsHGa\",\"en_tags.md\":\"OC9VFScx\",\"tags.md\":\"_2CtZTEA\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_05-java-client.md\":\"vxQQKNVN\",\"courses_interview_云原生_06-rollout.md\":\"yvCPLgZi\",\"categories_learning_ ai_01-ai.md\":\"4ye-VJbq\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_02-ilm.md\":\"uf07udbM\",\"blogs_translate_2023_04-life-of-a-packet-in-kubernetes-part-4.md\":\"6gz3fYLB\",\"categories_issues_bug万象集_02-ide.md\":\"qo4UmHEw\",\"categories_learning_ ai_02-gpu.md\":\"2tYB_UgC\",\"blogs_translate_2023_03-life-of-a-packet-in-kubernetes-part-3.md\":\"VMeZTwJF\",\"categories_learning_编程语言_03-design-pattern.md\":\"heinpklM\",\"courses_interview_云原生_07-operator.md\":\"CIls33sK\",\"courses_interview_云原生_03-storage.md\":\"1iyEHWha\",\"blogs_original_2024_02-sidecar-containers.md\":\"pjFuDuco\",\"categories_open-source_index.md\":\"fY8rQ0Ad\",\"meetup_network_01-network_01-cni.md\":\"nf9yZoFm\",\"courses_interview_操作系统_03-storage.md\":\"BXUVwzRn\",\"categories_issues_bug万象集_ 01-ebpf.md\":\"NP7rii4v\",\"en_about_me.md\":\"yvwryHCw\",\"en_archives.md\":\"a7CAsfZC\",\"blogs_translate_2023_07-git-cheat-sheet-3.md\":\"4NOrGXq5\",\"courses_interview_操作系统_05-cgroup.md\":\"wO9heyO5\",\"categories_learning_ ai_04-mcp.md\":\"RvmGlS43\",\"courses_interview_操作系统_04-network.md\":\"TGMGLLVR\",\"courses_elastic-stack_elastic stack 实战教程_05-java-client.md\":\"BtzwNW79\",\"courses_interview_编程语言_02-algorithm.md\":\"4H_D-Z49\",\"categories_learning_编程语言_02-golang.md\":\"QSUdIYiy\",\"categories_fragments_个人速查手册_03-idea-shortcut.md\":\"pqw4O4jx\",\"blogs_translate_2023_02-life-of-a-packet-in-kubernetes-part-2.md\":\"C-QfdBzo\",\"courses_interview_大数据_01-message-queue.md\":\"CCFrRbJ0\",\"courses_elastic-stack_elastic stack 实战教程_02-ilm.md\":\"TagiEwYZ\",\"categories_fragments_个人速查手册_02-find-docker-file.md\":\"SlqqaJyV\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_03-snapshot.md\":\"7d4wCVdg\",\"blogs_original_2024_01-crossplane.md\":\"_m3xhbRQ\",\"categories_issues_index.md\":\"gRqBYA5F\",\"courses_elastic-stack_elastic stack 实战教程_04-fleet.md\":\"_UhpHNTT\",\"courses_interview_云原生_05-security.md\":\"zxzWSLyL\",\"courses_interview_编程语言_01-golang.md\":\"IASVkdqQ\",\"courses_interview_云原生_01-kubernetes.md\":\"Q5ckm7uO\",\"meetup_network_index.md\":\"Ci23JCLs\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_01-quick-start.md\":\"xNq4q38q\",\"categories_fragments_个人速查手册_05-docker-command.md\":\"KWdIk24M\",\"courses_algorithm_算法_02-template.md\":\"hgDO36Fd\",\"courses_elastic-stack_elastic stack 实战教程_01-quick-start.md\":\"LqCet9Nl\",\"blogs_translate_2023_06-git-cheat-sheet-2.md\":\"dD319mh0\",\"courses_interview_操作系统_02-memory.md\":\"_-IMQWOM\",\"courses_interview_云原生_02-container.md\":\"NE_fAC3H\",\"categories_fragments_个人速查手册_04-ssh-proxy.md\":\"bWtRLdCJ\",\"en_about_index.md\":\"CpGKz0DC\",\"courses_elastic-stack_elastic stack 实战教程_03-snapshot.md\":\"PUUi7pbx\",\"en_index.md\":\"G77ErWAX\",\"categories_fragments_个人速查手册_01-git.md\":\"dWfQMGMB\",\"blogs_original_2024_03-higress-ai-plugins.md\":\"lnCCNECS\",\"courses_algorithm_算法_01-hot100.md\":\"JF83ejOi\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Se7en的架构笔记\",\"description\":\"个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Meetup\",\"items\":[{\"text\":\"网络\",\"link\":\"/meetup/network/index\",\"activeMatch\":\"/meetup/network/\"}],\"activeMatch\":\"/meetup/\"},{\"text\":\"博客\",\"items\":[{\"text\":\"原创\",\"link\":\"/blogs/original/index\",\"activeMatch\":\"/blogs/original/\"},{\"text\":\"翻译\",\"link\":\"/blogs/translate/index\",\"activeMatch\":\"/blogs/translate/\"}],\"activeMatch\":\"/blogs/\"},{\"text\":\"我的分类\",\"items\":[{\"text\":\"Bug万象集\",\"link\":\"/categories/issues/index\",\"activeMatch\":\"/categories/issues/\"},{\"text\":\"个人速查手册\",\"link\":\"/categories/fragments/index\",\"activeMatch\":\"/categories/fragments/\"},{\"text\":\"精选工具箱\",\"link\":\"/categories/tools/index\",\"activeMatch\":\"/categories/tools/\"},{\"text\":\"开源项目\",\"link\":\"/categories/open-source/index\",\"activeMatch\":\"/categories/open-source/\"},{\"text\":\"学习笔记\",\"link\":\"/categories/learning/index\",\"activeMatch\":\"/categories/learning/\"}],\"activeMatch\":\"/categories/\"},{\"text\":\"我的小册\",\"items\":[{\"text\":\"Elastic Stack 实战教程\",\"link\":\"/courses/elastic-stack/index\",\"activeMatch\":\"/courses/elastic-stack/\"},{\"text\":\"面试宝典\",\"link\":\"/courses/interview/index\",\"activeMatch\":\"/courses/interview/\"},{\"text\":\"数据结构与算法\",\"link\":\"/courses/algorithm/index\",\"activeMatch\":\"/courses/algorithm/\"}],\"activeMatch\":\"/courses/\"},{\"text\":\"我的标签\",\"link\":\"/tags\",\"activeMatch\":\"/tags\"},{\"text\":\"我的归档\",\"link\":\"/archives\",\"activeMatch\":\"/archives\"},{\"text\":\"关于\",\"items\":[{\"text\":\"关于知识库\",\"link\":\"/about/index\",\"activeMatch\":\"/about/index\"},{\"text\":\"关于我\",\"link\":\"/about/me\",\"activeMatch\":\"/about/me\"}],\"activeMatch\":\"/about/\"}],\"sidebar\":{\"/categories/issues/\":[{\"text\":\"Bug万象集 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>eBPF\",\"link\":\"/categories/issues/Bug万象集/ 01-ebpf\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>IDE\",\"link\":\"/categories/issues/Bug万象集/02-ide\"}],\"collapsed\":false}],\"/categories/fragments/\":[{\"text\":\"个人速查手册 (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Git 速查手册\",\"link\":\"/categories/fragments/个人速查手册/01-git\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>5 种快速查找容器中文件的方法\",\"link\":\"/categories/fragments/个人速查手册/02-find-docker-file\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>IDEA 快捷键\",\"link\":\"/categories/fragments/个人速查手册/03-idea-shortcut\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>使用 ClashX 代理 SSH 连接\",\"link\":\"/categories/fragments/个人速查手册/04-ssh-proxy\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Docker 常用命令\",\"link\":\"/categories/fragments/个人速查手册/05-docker-command\"}],\"collapsed\":false}],\"/categories/tools/\":[{\"text\":\"云原生 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>查询 Kubernetes 核心资源字段\",\"link\":\"/categories/tools/云原生/01-k8s-resource\"}],\"collapsed\":false},{\"text\":\"编程工具 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Windsurf 下一代 AI IDE\",\"link\":\"/categories/tools/编程工具/01-windsurf\"}],\"collapsed\":false}],\"/categories/learning/\":[{\"text\":\" AI (4篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/categories/learning/ AI/01-ai\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>GPU\",\"link\":\"/categories/learning/ AI/02-gpu\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>PyTorch\",\"link\":\"/categories/learning/ AI/03-pytorch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Model Context Protocol（MCP）\",\"link\":\"/categories/learning/ AI/04-mcp\"}],\"collapsed\":false},{\"text\":\"云原生 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Istio\",\"link\":\"/categories/learning/云原生/01-istio\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Observability\",\"link\":\"/categories/learning/云原生/02-observability\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>eBPF\",\"link\":\"/categories/learning/云原生/03-ebpf\"}],\"collapsed\":false},{\"text\":\"编程语言 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Rust\",\"link\":\"/categories/learning/编程语言/01-rust\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Go 并发编程\",\"link\":\"/categories/learning/编程语言/02-golang\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>设计模式\",\"link\":\"/categories/learning/编程语言/03-design-pattern\"}],\"collapsed\":false}],\"/categories/open-source/\":[{\"text\":\"开源项目 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/categories/open-source/开源项目/01-ai\"}],\"collapsed\":false}],\"/blogs/original/\":[{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/snake.svg\\\" title=\\\"蛇年\\\" alt=\\\"生肖\\\">\\n            2025年 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>一文带你入门 MCP（模型上下文协议）\",\"link\":\"/blogs/original//2025/01-mcp\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/dragon.svg\\\" title=\\\"龙年\\\" alt=\\\"生肖\\\">\\n            2024年 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Higress AI 插件对接通义千问大语言模型\",\"link\":\"/blogs/original//2024/03-higress-ai-plugins\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>深入剖析 Kubernetes 原生 Sidecar 容器\",\"link\":\"/blogs/original//2024/02-sidecar-containers\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Crossplane 实战：构建统一的云原生控制平面\",\"link\":\"/blogs/original//2024/01-crossplane\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/rabbit.svg\\\" title=\\\"兔年\\\" alt=\\\"生肖\\\">\\n            2023年 (10篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Containerlab + Kind 快速部署 Cilium BGP 环境\",\"link\":\"/blogs/original//2023/10-cilium-bgp\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>使用 ClusterResourceSet 为 Cluster API 集群自动安装 CNI 插件\",\"link\":\"/blogs/original//2023/09-clusterresourceset\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Cilium 多集群 Cluster Mesh 介绍\",\"link\":\"/blogs/original//2023/08-cilium-cluster-mesh\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>vCluster -- 基于虚拟集群的多租户方案\",\"link\":\"/blogs/original//2023/07-vcluster\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Kubernetes 多集群网络方案系列 2 -- Submariner 监控\",\"link\":\"/blogs/original//2023/06-kubernetes-multi-cluster-2\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>Kubernetes 多集群网络方案系列 1 -- Submariner 介绍\",\"link\":\"/blogs/original//2023/05-kubernetes-multi-cluster-1\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>在 Kubernetes 中使用 Keycloak OIDC Provider 对用户进行身份验证\",\"link\":\"/blogs/original//2023/04-kubernetes-keycloak-oidc\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>使用 Kubectl Patch 命令更新资源\",\"link\":\"/blogs/original//2023/03-kubectl-patch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>WebAssembly 在云原生中的实践指南\",\"link\":\"/blogs/original//2023/02-wasm-in-cloud-native\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>ArgoCD 简明教程\",\"link\":\"/blogs/original//2023/01-argocd-quickstart\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/tiger.svg\\\" title=\\\"虎年\\\" alt=\\\"生肖\\\">\\n            2022年 (13篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Envoy 作为前端代理\",\"link\":\"/blogs/original//2022/13-envoy-quickstart\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>实现 LRU 缓存算法\",\"link\":\"/blogs/original//2022/12.lru\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Nebula 分布式图数据库介绍\",\"link\":\"/blogs/original//2022/11.nebula\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Habor 部署指南\",\"link\":\"/blogs/original//2022/10-harbor\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Pulsar 介绍与部署\",\"link\":\"/blogs/original//2022/09-pulsar\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>如何重置 Kafka 中的 Consumer Offset？\",\"link\":\"/blogs/original//2022/08-reset-kafka-consumer-offset\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>如何往 Kafka 发送大消息？\",\"link\":\"/blogs/original//2022/07-kafka-big-message\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>Kafka 生产环境部署指南\",\"link\":\"/blogs/original//2022/06-kafka-setup\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>Docker Rootless 在非特权模式下运行 Docker\",\"link\":\"/blogs/original//2022/05-docker-rootless\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>使用 ezctl 工具部署和管理 Kubernetes 集群\",\"link\":\"/blogs/original//2022/04-kubeasz\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">11</div>Kubernetes 中的对象是如何删除的：Finalizers 字段介绍\",\"link\":\"/blogs/original//2022/03-finalizer\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">12</div>Kubectl debug 调试容器\",\"link\":\"/blogs/original//2022/02-kubectl-debug\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">13</div>Kubenetes 高可用集群搭建\",\"link\":\"/blogs/original//2022/01-kubernetes-setup\"}],\"collapsed\":false}],\"/blogs/translate/\":[{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/rabbit.svg\\\" title=\\\"兔年\\\" alt=\\\"生肖\\\">\\n            2023年 (7篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Git 速查表：专家必备的 14 个 Git 命令\",\"link\":\"/blogs/translate//2023/07-git-cheat-sheet-3\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Git 速查表：中级用户必备的 12 个 Git 命令\",\"link\":\"/blogs/translate//2023/06-git-cheat-sheet-2\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Git 速查表：初学者必备的 12 个 Git 命令\",\"link\":\"/blogs/translate//2023/05-git-cheat-sheet-1\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Kubernetes 中数据包的生命周期 -- 第 4 部分\",\"link\":\"/blogs/translate//2023/04-life-of-a-packet-in-kubernetes-part-4\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Kubernetes 中数据包的生命周期 -- 第 3 部分\",\"link\":\"/blogs/translate//2023/03-life-of-a-packet-in-kubernetes-part-3\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>Kubernetes 中数据包的生命周期 -- 第 2 部分\",\"link\":\"/blogs/translate//2023/02-life-of-a-packet-in-kubernetes-part-2\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>Kubernetes 中数据包的生命周期 -- 第 1 部分\",\"link\":\"/blogs/translate//2023/01-life-of-a-packet-in-kubernetes-part-1\"}],\"collapsed\":false}],\"/courses/elastic-stack/\":[{\"text\":\"Elastic Stack 实战教程 (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Elastic Stack 8 快速上手\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/01-quick-start\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>ILM 索引生命周期管理\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/02-ilm\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>快照备份与恢复\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/03-snapshot\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>使用 Fleet 管理 Elastic Agent 监控应用\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/04-fleet\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Elasticsearch Java API Client 开发\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/05-java-client\"}],\"collapsed\":false}],\"/courses/interview/\":[{\"text\":\"AI (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/courses/interview/AI/01-ai\"}],\"collapsed\":false},{\"text\":\"Elastic Stack (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Elasticsearch\",\"link\":\"/courses/interview/Elastic Stack/01-elasticsearch\"}],\"collapsed\":false},{\"text\":\"云原生 (7篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Kubernetes\",\"link\":\"/courses/interview/云原生/01-kubernetes\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>容器\",\"link\":\"/courses/interview/云原生/02-container\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>存储\",\"link\":\"/courses/interview/云原生/03-storage\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>网络\",\"link\":\"/courses/interview/云原生/04-network\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>安全\",\"link\":\"/courses/interview/云原生/05-security\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>发布\",\"link\":\"/courses/interview/云原生/06-rollout\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>Operator\",\"link\":\"/courses/interview/云原生/07-operator\"}],\"collapsed\":false},{\"text\":\"大数据 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>消息队列\",\"link\":\"/courses/interview/大数据/01-message-queue\"}],\"collapsed\":false},{\"text\":\"操作系统 (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>CPU\",\"link\":\"/courses/interview/操作系统/01-cpu\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>内存\",\"link\":\"/courses/interview/操作系统/02-memory\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>存储\",\"link\":\"/courses/interview/操作系统/03-storage\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>网络\",\"link\":\"/courses/interview/操作系统/04-network\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>cgroup\",\"link\":\"/courses/interview/操作系统/05-cgroup\"}],\"collapsed\":false},{\"text\":\"编程语言 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Golang\",\"link\":\"/courses/interview/编程语言/01-golang\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>数据结构与算法\",\"link\":\"/courses/interview/编程语言/02-algorithm\"}],\"collapsed\":false}],\"/courses/algorithm/\":[{\"text\":\"算法 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Hot 100 算法题\",\"link\":\"/courses/algorithm/算法/01-hot100\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>算法解题套路框架\",\"link\":\"/courses/algorithm/算法/02-template\"}],\"collapsed\":false}],\"/meetup/network/\":[{\"text\":\"network (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>CNI (Container Network Interface)\",\"link\":\"/meetup/network/01-network/01-cni\"}],\"collapsed\":false}]},\"sidebarCollapsible\":false,\"logo\":\"/logo.png\",\"outline\":{\"level\":\"deep\",\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"editLink\":{\"pattern\":\"https://github.com/cr7258/cr7258.github.io/edit/main/docs/:path\",\"text\":\"不妥之处，敬请雅正\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/cr7258/cr7258.github.io\"}],\"articleMetadataConfig\":{\"author\":\"Se7en\",\"authorLink\":\"/about/me\",\"showViewCount\":false},\"copyrightConfig\":{\"license\":\"署名-相同方式共享 4.0 国际 (CC BY-SA 4.0)\",\"licenseLink\":\"http://creativecommons.org/licenses/by-sa/4.0/\"},\"commentConfig\":{\"type\":\"gitalk\",\"showComment\":true},\"footerConfig\":{\"showFooter\":true,\"copyright\":\"Copyright  2023-2025 Se7en\"}},\"locales\":{\"root\":{\"label\":\"中文\",\"lang\":\"zh\"},\"en\":{\"label\":\"English\",\"lang\":\"en\"}},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>
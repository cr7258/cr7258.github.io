<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes 中数据包的生命周期 -- 第 1 部分 | Se7en的架构笔记</title>
    <meta name="description" content="个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。">
    <meta name="generator" content="VitePress v1.0.0-rc.31">
    <link rel="preload stylesheet" href="/assets/style.D1CN3_0g.css" as="style">
    
    <script type="module" src="/assets/app.DbbcoGoM.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.BhFhJsV2.js">
    <link rel="modulepreload" href="/assets/chunks/theme.Dxq3JPXp.js">
    <link rel="modulepreload" href="/assets/chunks/md5.Ek22RXBH.js">
    <link rel="modulepreload" href="/assets/chunks/use-popup-manager.D8z7Eyf4.js">
    <link rel="modulepreload" href="/assets/chunks/DirectoryList.DeyocdgM.js">
    <link rel="modulepreload" href="/assets/chunks/ArticleMetadata.CBANxfkh.js">
    <link rel="modulepreload" href="/assets/blogs_translate_2023_01-life-of-a-packet-in-kubernetes-part-1.md.BaZV78NJ.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="author" content="Se7en">
    <meta name="keywords" content="Se7en的架构笔记, 知识库, 博客, Se7en">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#3c8772">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="Se7en的架构笔记">
    <meta property="og:description" content="个人技术知识库，记录 &amp; 分享个人碎片化、结构化、体系化的技术知识内容。">
    <meta property="og:site" content="https://blog.charles7c.top">
    <meta property="og:site_name" content="Se7en的架构笔记">
    <meta property="og:image" content="https://blog.charles7c.top/logo.jpg">
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?53af4b1a12fbe40810ca7ad39f8db9c7";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-35dc2bb5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-7b57b1c6></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-7b57b1c6> Skip to content </a><!--]--><!----><header class="VPNav" data-v-35dc2bb5 data-v-a7a40036><div class="VPNavBar" data-v-a7a40036 data-v-dda4e55a><div class="container" data-v-dda4e55a><div class="title" data-v-dda4e55a><div class="VPNavBarTitle has-sidebar" data-v-dda4e55a data-v-c6cb2f9d><a class="title" href="/" data-v-c6cb2f9d><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-f8627e12><!--]--><!--[-->Se7en的架构笔记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-dda4e55a><div class="curtain" data-v-dda4e55a></div><div class="content-body" data-v-dda4e55a><!--[--><!--]--><div class="VPNavBarSearch search" data-v-dda4e55a><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-dda4e55a data-v-8c764e32><span id="main-nav-aria-label" class="visually-hidden" data-v-8c764e32>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-8c764e32 data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6108d6af><span class="text" data-v-6108d6af><!----><span data-v-6108d6af>博客</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6108d6af><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><div class="items" data-v-7aa0a042><!--[--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/blogs/original/index" data-v-c83dc579><!--[-->原创<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link active" href="/blogs/translate/index" data-v-c83dc579><!--[-->翻译<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8c764e32 data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6108d6af><span class="text" data-v-6108d6af><!----><span data-v-6108d6af>我的分类</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6108d6af><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><div class="items" data-v-7aa0a042><!--[--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/categories/issues/index" data-v-c83dc579><!--[-->Bug万象集<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/categories/fragments/index" data-v-c83dc579><!--[-->个人速查手册<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/categories/tools/index" data-v-c83dc579><!--[-->精选工具箱<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/categories/open-source/index" data-v-c83dc579><!--[-->开源项目<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/categories/learning/index" data-v-c83dc579><!--[-->学习笔记<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8c764e32 data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6108d6af><span class="text" data-v-6108d6af><!----><span data-v-6108d6af>我的小册</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6108d6af><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><div class="items" data-v-7aa0a042><!--[--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/courses/elastic-stack/index" data-v-c83dc579><!--[-->Elastic Stack 实战教程<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/courses/interview/index" data-v-c83dc579><!--[-->面试宝典<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/courses/algorithm/index" data-v-c83dc579><!--[-->数据结构与算法<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tags" tabindex="0" data-v-8c764e32 data-v-345d5199><!--[--><span data-v-345d5199>我的标签</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/archives" tabindex="0" data-v-8c764e32 data-v-345d5199><!--[--><span data-v-345d5199>我的归档</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8c764e32 data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6108d6af><span class="text" data-v-6108d6af><!----><span data-v-6108d6af>关于</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6108d6af><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><div class="items" data-v-7aa0a042><!--[--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/about/index" data-v-c83dc579><!--[-->关于知识库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7aa0a042 data-v-c83dc579><a class="VPLink link" href="/about/me" data-v-c83dc579><!--[-->关于我<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-dda4e55a data-v-08f92e2e data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-6108d6af><span class="text" data-v-6108d6af><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-6108d6af><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg><!----><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6108d6af><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><!----><!--[--><!--[--><div class="items" data-v-08f92e2e><p class="title" data-v-08f92e2e>中文</p><!--[--><div class="VPMenuLink" data-v-08f92e2e data-v-c83dc579><a class="VPLink link" href="/en/blogs/translate/2023/01-life-of-a-packet-in-kubernetes-part-1" data-v-c83dc579><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-dda4e55a data-v-cb86f72f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-cb86f72f data-v-3629c4f2 data-v-82a3cc14><span class="check" data-v-82a3cc14><span class="icon" data-v-82a3cc14><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3629c4f2><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3629c4f2><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-dda4e55a data-v-dbef8c0e data-v-046c3fce><!--[--><a class="VPSocialLink no-icon" href="https://github.com/cr7258/cr7258.github.io" aria-label="github" target="_blank" rel="noopener" data-v-046c3fce data-v-6a719586><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-dda4e55a data-v-63dc44f8 data-v-6108d6af><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6108d6af><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6108d6af><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6108d6af><div class="VPMenu" data-v-6108d6af data-v-7aa0a042><!----><!--[--><!--[--><div class="group translations" data-v-63dc44f8><p class="trans-title" data-v-63dc44f8>中文</p><!--[--><div class="VPMenuLink" data-v-63dc44f8 data-v-c83dc579><a class="VPLink link" href="/en/blogs/translate/2023/01-life-of-a-packet-in-kubernetes-part-1" data-v-c83dc579><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-63dc44f8><div class="item appearance" data-v-63dc44f8><p class="label" data-v-63dc44f8>切换日光/暗黑模式</p><div class="appearance-action" data-v-63dc44f8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-63dc44f8 data-v-3629c4f2 data-v-82a3cc14><span class="check" data-v-82a3cc14><span class="icon" data-v-82a3cc14><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3629c4f2><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3629c4f2><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-63dc44f8><div class="item social-links" data-v-63dc44f8><div class="VPSocialLinks social-links-list" data-v-63dc44f8 data-v-046c3fce><!--[--><a class="VPSocialLink no-icon" href="https://github.com/cr7258/cr7258.github.io" aria-label="github" target="_blank" rel="noopener" data-v-046c3fce data-v-6a719586><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-dda4e55a data-v-b2b02586><span class="container" data-v-b2b02586><span class="top" data-v-b2b02586></span><span class="middle" data-v-b2b02586></span><span class="bottom" data-v-b2b02586></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-35dc2bb5 data-v-621d26f0><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-621d26f0><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-621d26f0><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-621d26f0>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-621d26f0 data-v-9fe47778><button data-v-9fe47778>返回顶部</button><!----></div></div><aside class="VPSidebar" data-v-35dc2bb5 data-v-795e9128><div class="curtain" data-v-795e9128></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-795e9128><span class="visually-hidden" id="sidebar-aria-label" data-v-795e9128> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-795e9128><section class="VPSidebarItem level-0 collapsible" data-v-795e9128 data-v-b9dba202><div class="item" role="button" tabindex="0" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><h2 class="text" data-v-b9dba202><img class="chinese-zodiac" style="position: static; vertical-align: middle; padding-bottom: 3px;" src="/img/svg/chinese-zodiac/rabbit.svg" title="兔年" alt="生肖">
            2023年 (7篇)</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b9dba202><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-b9dba202><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-b9dba202><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/07-git-cheat-sheet-3" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>Git 速查表：专家必备的 14 个 Git 命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/06-git-cheat-sheet-2" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-orange mr-[6px]" style="font-weight: 550; display: inline-block;">2</div>Git 速查表：中级用户必备的 12 个 Git 命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/05-git-cheat-sheet-1" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-yellow mr-[6px]" style="font-weight: 550; display: inline-block;">3</div>Git 速查表：初学者必备的 12 个 Git 命令</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/04-life-of-a-packet-in-kubernetes-part-4" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">4</div>Kubernetes 中数据包的生命周期 -- 第 4 部分</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/03-life-of-a-packet-in-kubernetes-part-3" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">5</div>Kubernetes 中数据包的生命周期 -- 第 3 部分</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/02-life-of-a-packet-in-kubernetes-part-2" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">6</div>Kubernetes 中数据包的生命周期 -- 第 2 部分</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b9dba202 data-v-b9dba202><div class="item" data-v-b9dba202><div class="indicator" data-v-b9dba202></div><a class="VPLink link link" href="/blogs/translate/2023/01-life-of-a-packet-in-kubernetes-part-1" data-v-b9dba202><!--[--><p class="text" data-v-b9dba202><div class="text-color-gray mr-[6px]" style="font-weight: 550; display: inline-block;">7</div>Kubernetes 中数据包的生命周期 -- 第 1 部分</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-35dc2bb5 data-v-5d1e9e49><div class="VPDoc has-sidebar has-aside" data-v-5d1e9e49 data-v-fd9366c1><!--[--><!--]--><div class="container" data-v-fd9366c1><div class="aside" data-v-fd9366c1><div class="aside-curtain" data-v-fd9366c1></div><div class="aside-container" data-v-fd9366c1><div class="aside-content" data-v-fd9366c1><div class="VPDocAside" data-v-fd9366c1 data-v-ae914918><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-ae914918 data-v-51d604ad><div class="content" data-v-51d604ad><div class="outline-marker" data-v-51d604ad></div><div class="outline-title" role="heading" aria-level="2" data-v-51d604ad>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-51d604ad><span class="visually-hidden" id="doc-outline-aria-label" data-v-51d604ad> Table of Contents for current page </span><ul class="root" data-v-51d604ad data-v-64adc1f2><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-ae914918></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-fd9366c1><div class="content-container" data-v-fd9366c1><!--[--><!--]--><!----><main class="main" data-v-fd9366c1><div style="position:relative;" class="vp-doc _blogs_translate_2023_01-life-of-a-packet-in-kubernetes-part-1" data-v-fd9366c1><div><h1 id="kubernetes-中数据包的生命周期-第-1-部分" tabindex="-1">Kubernetes 中数据包的生命周期 -- 第 1 部分 <a class="header-anchor" href="#kubernetes-中数据包的生命周期-第-1-部分" aria-label="Permalink to &quot;Kubernetes 中数据包的生命周期 -- 第 1 部分&quot;">​</a></h1><!----><blockquote><p>本文翻译自：<a href="https://medium.com/@dramasamy/life-of-a-packet-in-kubernetes-part-1-f9bc0909e051" target="_blank" rel="noreferrer">Life of a Packet in Kubernetes — Part 1 [1]</a><br> 作者：Dinesh Kumar Ramasamy<br> 本文在原文的基础上做了适当的修改，如有疑问请查阅原文。</p></blockquote><p>Kubernetes 集群中的网络可能会令人感到有点困惑，即便是对于拥有虚拟网络和路由实践经验的工程师来说也是如此。本系列文章将分为 4 个部分，帮助你理解基本的 Kubernetes 网络，本文属于第 1 部分。</p><ul><li>Part 1 <ul><li>1.Linux 命名空间（Namespaces）</li><li>2.容器网络（Network Namespace）</li><li>3.什么是 CNI？</li><li>4.Pod 网络命名空间</li></ul></li><li>Part 2 <ul><li>1.Calico CNI</li></ul></li><li>Part 3 <ul><li>1.Pod-to-Pod</li><li>2.Pod-to-External</li><li>3.Pod-to-Service</li><li>4.External-to-Pod</li><li>5.External Traffic Policy</li><li>6.Kube-Proxy</li><li>7.iptable rules processing flow</li><li>8.Network Policy basics</li></ul></li><li>Part 4 <ul><li>1.Ingress Controller</li><li>2.Ingress Resources Example</li><li>3.Nginx</li><li>4.Envoy+Contour</li><li>5.Ingress with MetalLB</li></ul></li></ul><h2 id="linux-命名空间-namespaces" tabindex="-1">Linux 命名空间（Namespaces） <a class="header-anchor" href="#linux-命名空间-namespaces" aria-label="Permalink to &quot;Linux 命名空间（Namespaces）&quot;">​</a></h2><p>Linux namespace 包含了大多数现代容器实现背后的一些基本技术。从高层次来看，它们允许在独立的进程之间隔离全局系统资源。例如，PID namespace 隔离了进程 ID，这意味着在同一主机上运行的两个进程可以具有相同的 PID！</p><p>这种隔离级别显然在容器领域非常有用。假如没有 namespace 技术，在容器 A 中运行的进程甚至可以 umount 容器 B 中重要的文件系统，或更改容器 C 中的主机名，或从容器 D 中删除网络接口，这将会非常危险！当通过 namespace 技术隔离这些资源后，容器 A 中的进程甚至不知道容器 B, C, D 中进程的存在，这样进程之间进行的操作，都不会互相干扰，安全性可以得到保障。</p><ul><li>1.<strong>Mount</strong> -- 隔离文件系统挂载点。</li><li>2.<strong>UTS</strong> -- 隔离主机名和域名。</li><li>3.<strong>IPC</strong> -- 隔离进程间通信资源。</li><li>4.<strong>PID</strong> -- 隔离进程 ID。</li><li>5.<strong>Network</strong> -- 隔离网络资源。</li><li>6.<strong>User</strong> -- 隔离用户和用户组。</li><li>7.<strong>Cgroup</strong> -- 隔离 Cgroups 根目录。</li></ul><p>大多数容器实现都使用上述的 namespace，以便在不同的容器进程之间提供最高级别的隔离。由于 Cgroup namespace 比其他 namespace 技术出现得稍晚一些，因此尚未被广泛使用。</p><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420152147.png" alt=""></p><h2 id="容器网络-network-namespace" tabindex="-1">容器网络（Network Namespace） <a class="header-anchor" href="#容器网络-network-namespace" aria-label="Permalink to &quot;容器网络（Network Namespace）&quot;">​</a></h2><p>在我们开始了解 CNI 和 Docker 提供的各种功能之前，让我们探索一下驱动容器网络的核心技术。Linux 内核已经具有在主机上实现多租户的各种功能。namespace 为不同类型的资源提供了隔离的功能，其中 network namespace 提供了网络资源的隔离。 在 Linux 操作系统中，可以很容易地使用 <strong>ip</strong> 命令创建 network namespace。让我们创建两个不同的 network namespace，并分别将它们命名为 client 和 server。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">client</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420153805.png" alt=""></p><p>创建一个 <strong>veth</strong> 对来连接这两个 network namespace，<strong>veth</strong> 对可以看作是一根网线。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">4:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server@veth-client:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAST,M-DOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">5:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client@veth-server:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAST,M-DOW</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420154101.png" alt=""></p><p>当前 <strong>veth</strong> 对在主机的 network namespace 中，现在让我们将 <strong>veth</strong> 对的两端分别接在前面创建的两个 namespace 中。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 此时 veth 对不在主机的 network namespace 中了</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420155049.png" alt=""></p><p>让我们验证 namespace 中确实存在 <strong>veth</strong> 对，首先从 <strong>client</strong> namespace 开始。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LOOPBAC</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">K</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">5:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client@if4:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAS</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/ether</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca:e8:30:2e:f9:d2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ff:ff:ff:ff:ff:ff</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link-netnsid</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span></code></pre></div><p>接着确认 <strong>server</strong> namespace。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LOOPBAC</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">K</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">4:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server@if5:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAS</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/ether</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 42</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:96:f0:ae:f0:c5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ff:ff:ff:ff:ff:ff</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link-netnsid</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span></code></pre></div><p>现在让我们为这些接口分配 IP 地址并启用它们。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> address</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.11/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> address</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LOOPBAC</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">K</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">5:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client@if4:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noqueue</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/ether</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ca:e8:30:2e:f9:d2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ff:ff:ff:ff:ff:ff</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link-netnsid</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.11/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> global</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-client</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fe80::c8e8:30ff:fe2e:f9d2/64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LOOPBAC</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">K</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">4:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server@if5:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noqueue</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/ether</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 42</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:96:f0:ae:f0:c5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ff:ff:ff:ff:ff:ff</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link-netnsid</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> global</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fe80::4096:f0ff:feae:f0c5/64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420155747.png" alt=""></p><p>使用 ping 命令，我们可以验证两个 network namespace 已经连接并且可以访问。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master#</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">PING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (10.0.0.12) 56(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) bytes of data.  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.101</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.072</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.084</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.077</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.079</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span></code></pre></div><p>如果我们想创建更多的 network namespace 并将它们连接在一起，那么为每个 namespace 创建一个 <strong>veth</strong> 对可能不是一个可扩展的解决方案。相反，可以创建一个 Linux 网桥并将这些 network namespace 连接到网桥实现互通。这正是 Docker 在同一主机上运行的容器之间建立网络的方式！ 让我们创建 namespace 并将其添加到网桥中，<strong>BR</strong> 和 <strong>HOST_IP</strong> 两个变量根据主机的实际情况进行修改。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">BR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">bridge1</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 网桥名字</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOST_IP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.33</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 主机地址</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建 veth 对</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth-br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> peer</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth-br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建网桥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $BR </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bridge</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建 network namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 连接 veth 对与 network namespace </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 连接 veth 对的另一端与网桥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth-br</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> master</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $BR  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth-br</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> master</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $BR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 启用网桥，接口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $BR </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">up</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth-br</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth-br</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 为接口添加 IP 地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.11/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1-veth</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1-veth</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.1/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $BR</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420161407.png" alt=""></p><p>使用 ping 命令，我们可以验证两个 network namespace 已经连接并且可以访问。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">PING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (172.30.0.12) 56(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) bytes of data.  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.138</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.091</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.073</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.070</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.12:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.107</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span></code></pre></div><p>如果上面的 ping 命令不通可能是由于 Docker 将 iptables 的 FORWARD 链默认动作设置为 DROP，参见 <a href="https://docs.docker.com/network/iptables/#docker-on-a-router" target="_blank" rel="noreferrer">Docker 官网 [2]</a>。 可以使用以下命令将 FORWARD 设置为 ACCEPT。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> FORWARD</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ACCEPT</span></span></code></pre></div><p>让我们从 namespace 中 ping 主机地址。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOST_IP </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connect:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Network</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unreachable</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 网络不可达</span></span></code></pre></div><p>收到了“网络不可以达“的响应，这是因为在新创建的 namespace 中没有配置路由。让我们添加一条默认路由。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> route</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.30</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOST_IP </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">PING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (172.17.0.23) 56(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) bytes of data.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.053</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.121</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.078</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.129</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.119</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">---</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> statistics</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> transmitted,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> received,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loss,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3999</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rtt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> min/avg/max/mdev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.053</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/0.100/0.129/0.029</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span></code></pre></div><p>现在通往外部的默认路由指向了网桥，因此在 namespace 中可以访问任何外部服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.8.8</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">PING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.8.8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (8.8.8.8) 56(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) bytes of data.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.8.8:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">117</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3.40</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.8.8:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">117</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3.81</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">---</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.8.8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ping</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> statistics</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> transmitted,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> received,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loss,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> time</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1001</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rtt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> min/avg/max/mdev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3.403</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/3.610/3.817/0.207</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ms</span></span></code></pre></div><p><strong>那么如何从外部访问私有网络呢？</strong> 如你所见，我们演示的机器已经安装了 Docker，并且 Docker 自动创建了一个名为 <strong>docker0</strong> 的网桥。在 network namespace 中运行 Web 服务并不容易，因为所有的 Linux namespace 都需要互通以模拟这种情况。让我们使用 Docker 来模拟场景。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   Link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> encap:Ethernet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  HWaddr</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:42:e2:44:07:39</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          inet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr:172.18.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Bcast:172.18.0.255</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Mask:255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> BROADCAST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MULTICAST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  MTU:1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Metric:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> frame:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          TX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> carrier:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          collisions:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> txqueuelen:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes:0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  TX bytes:0 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>现在让我们启动一个 Nginx 容器并查看它。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 启动 Nginx 容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> web</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">efff2d2c98f94671f69cddc5cc88bb7a0a5a2ea15dc3c98d911e39bf2764a556</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 获取容器 IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">WEB_IP=`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inspect </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{{ .NetworkSettings.IPAddress }}&quot; web`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 获取容器的 network namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> web</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --format</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{{ .NetworkSettings.SandboxKey }}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">/var/run/docker/netns/c009f2a4be71</span></span></code></pre></div><p>由于 Docker 不会在默认位置（<em>var/run/netns/</em> 目录）创建 <strong>netns</strong>，因此 <strong>ip netns list</strong> 命令不会显示这个 network namespace。我们可以创建符号连接指向预期位置来解决。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">container_id=web</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">container_netns=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inspect ${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">container_id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--format</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{{ .NetworkSettings.SandboxKey }}&#39;)</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/run/netns</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/run/netns/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${container_id}  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -sv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ${container_netns} </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/var/run/netns/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${container_id}  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;/var/run/netns/web&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/var/run/docker/netns/c009f2a4be71&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">web</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 容器的 network namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">server1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">client1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>让我们检查一下 web namespace 中的 IP 地址。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> web</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LOOPBACK,UP,LOWER_U</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noqueue</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> UNKNOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlen</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/loopback</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:00:00:00:00:00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.1/8</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> host</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eth0@if12:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">P</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qdisc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> noqueue</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    link/ether</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:42:ac:12:00:03</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ff:ff:ff:ff:ff:ff</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link-netnsid</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.3/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> brd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.255</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> global</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">       valid_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preferred_lft</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> forever</span></span></code></pre></div><p>让我们检查一下 Docker 容器中的 IP 地址。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">WEB_IP=`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inspect </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{{ .NetworkSettings.IPAddress }}&quot; web`</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $WEB_IP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">172.18.0.3</span></span></code></pre></div><p>很明显，Docker 使用了所有的 Linux namespace 并将容器与主机隔离开来。让我们尝试从主机访问运行在 web namespace 中的 Web 服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">curl</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $WEB_IP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">DOCTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    body</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        width:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 35</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">em</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        margin:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> auto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        font-family:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Tahoma,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Verdana,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Arial,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sans-serif</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">If you see this page, the nginx web server is successfully installed and</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">working.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Further</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> required.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">For online documentation and support please refer to</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.org/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.org</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">br/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Commercial</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> support</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> available</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.com/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p&gt;&lt;em</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Thank you </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> using nginx.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/em&gt;&lt;/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span></code></pre></div><p>是否可以从外部网络访问这个 Web 服务呢？是的，需要添加端口转发。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nat</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PREROUTING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DNAT</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --to-destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $WEB_IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $HOST_IP  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">172.17.0.23</span></span></code></pre></div><p>让我们尝试在外部主机访问 Web 服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">node01</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 172.17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.23</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">DOCTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    body</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        width:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 35</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">em</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        margin:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> auto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        font-family:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Tahoma,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Verdana,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Arial,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sans-serif</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">If you see this page, the nginx web server is successfully installed and</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">working.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Further</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> required.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">For online documentation and support please refer to</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.org/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.org</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">br/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Commercial</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> support</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> available</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.com/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p&gt;&lt;em</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Thank you </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> using nginx.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/em&gt;&lt;/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span></code></pre></div><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420170033.png" alt=""></p><p>CNI 插件执行上述的命令（不完全是，但类似）来设置 loopback 接口，eth0 接口，并将 IP 地址分配给容器。容器运行时（例如 Kubernetes，Podman 等等）利用 CNI 来设置 Pod 网络。让我们在下一个章节讨论 CNI。</p><h2 id="什么是-cni" tabindex="-1">什么是 CNI？ <a class="header-anchor" href="#什么是-cni" aria-label="Permalink to &quot;什么是 CNI？&quot;">​</a></h2><p>CNI 插件负责将网络接口接入容器的 network namespace（例如 veth 对的一端）并在主机上进行任何必要的更改（例如将 veth 的另一端连接到网桥中）。然后调用合适的 IPAM 插件为接口分配 IP 地址并设置路由。</p><p><strong>等等，似曾相识？</strong> 是的，我们已经在<strong>容器网络</strong>章节中提到了这一点。</p><p>CNI (Container Network Interface，容器网络接口) 是一个 Cloud Native Computing Foundation（云原生计算基金会）的项目，由一系列规范和库组成，用于编写配置 Linux 容器网络的插件。由于 CNI 规范专注于容器的网络连接，并且易于实现，因此得到了广泛的支持。</p><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420172228.png" alt=""></p><p>详情参见：<a href="https://github.com/containernetworking/cni/blob/master/SPEC.md" target="_blank" rel="noreferrer">CNI 规范 [3]</a>。以下是我在第一次通读时发现的一些有趣的点：</p><ul><li>规范中将容器定义为 Linux network namespace。我们应该对这个定义感到满意，因为像 Docker 这样的容器运行时会为每个容器创建一个新的 network namespace。</li><li>网络配置由 JSON 对象组成。</li><li>网络配置通过 STDIN 输入流的方式传递给插件，也就是说主机上没有用于网络配置的文件。</li><li>其他参数通过环境变量传递给插件。</li><li>CNI 插件被实现为一个可执行文件。</li><li>CNI 插件负责连接容器，也就是说它需要将容器接入网络。</li><li>CNI 插件负责调用 IPAM 插件为容器分配 IP 地址并设置路由。</li></ul><p>让我们尝试在没有 Kubernetes 的情况下手动模拟 Pod 的创建，并通过 CNI 插件分配 IP 地址。 第 1 步：下载 CNI 插件。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cni</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cni</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -O</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/containernetworking/cni/releases/download/v0.4.0/cni-amd64-v0.4.0.tgz</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -xvf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cni-amd64-v0.4.0.tgz</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./macvlan</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./dhcp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./loopback</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./ptp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./ipvlan</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./bridge</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./tuning</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./noop</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./host-local</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./cnitool</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./flannel</span></span></code></pre></div><p>第 2 步：创建 JSON 格式的 CNI 配置。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/00-demo.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;"> EOF</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;cniVersion&quot;: &quot;0.2.0&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;name&quot;: &quot;demo_br&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;type&quot;: &quot;bridge&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;bridge&quot;: &quot;cni_net0&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;isGateway&quot;: true,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;ipMasq&quot;: true,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;ipam&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        &quot;type&quot;: &quot;host-local&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        &quot;subnet&quot;: &quot;10.0.10.0/24&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        &quot;routes&quot;: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            { &quot;dst&quot;: &quot;0.0.0.0/0&quot; },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            { &quot;dst&quot;: &quot;1.1.1.1/32&quot;, &quot;gw&quot;:&quot;10.0.10.1&quot;}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">EOF</span></span></code></pre></div><p>CNI 的配置参数如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-:CNI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 通用参数:-</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cniVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 定义</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> CNI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 的版本。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 网络名称。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">使用的插件名称。在本例中,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 是插件可执行文件的名称。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">args:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 可选的附加参数。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ipMasq:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 为网络配置源地址转换（SNAT）。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ipam:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">IPAM</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 插件名称。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    subnet:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 分配的子网。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    routes:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        dst:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 目的网段。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        gw:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 去往目的网段的下一跳地址，如果没有指定则使用子网的默认网关。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dns:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    nameservers:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DNS服务器列表。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    domain:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DNS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 请求的搜索域。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    search:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DNS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 请求的搜索域列表。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    options:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 传递给接收者的选项列表。</span></span></code></pre></div><p>第 3 步：创建一个具有 <strong>none</strong> 网络类型的容器，这样容器就不会使用任何 IP 地址。你可以使用任何镜像来创建容器，这里我使用 <strong>pause</strong> 容器来模拟 Kubernetes。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pause_demo</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --network</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> none</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes/pause</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 将 Docker 创建的 network namespace 文件软连接到默认路径</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">container_id=pause_demo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">container_netns=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inspect ${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">container_id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--format</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{{ .NetworkSettings.SandboxKey }}&#39;)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/run/netns</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/run/netns/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${container_id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -sv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ${container_netns} </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/var/run/netns/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">${container_id}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;/var/run/netns/pause_demo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/var/run/docker/netns/0297681f79b5&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看 network namespace</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pause_demo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看容器接口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $container_id </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ifconfig</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">lo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        Link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> encap:Local</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Loopback</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          inet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr:127.0.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Mask:255.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LOOPBACK</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RUNNING</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  MTU:65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Metric:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> frame:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          TX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> carrier:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          collisions:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> txqueuelen:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes:0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  TX bytes:0 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>第 4 步：用配置文件执行 CNI 插件。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CNI_CONTAINERID=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$container_id </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">CNI_IFNAME=eth10 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">CNI_COMMAND=ADD</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">CNI_NETNS=/var/run/netns/$container_id </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">CNI_PATH=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">`</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">pwd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ./bridge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp/00-demo.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 返回结果，第一次执行该命令会报错，容器网络仍然会设置成功</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># /var/lib/cni/networks/demo_br/last_reserved_ip 文件用于记录已经分配的 IP 地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 第一次执行以后会自动生成该文件，后续执行就不会报错了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2020/10/17</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:32:37</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Error</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> retriving</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> last</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reserved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Failed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> retrieve</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> last</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reserved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/lib/cni/networks/demo_br/last_reserved_ip:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> no</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> such</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> directory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;ip4&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        &quot;ip&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;10.0.10.2/24&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        &quot;gateway&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;10.0.10.1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        &quot;routes&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">                &quot;dst&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;0.0.0.0/0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">                &quot;dst&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;1.1.1.1/32&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">                &quot;gw&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;10.0.10.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;dns&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ul><li><strong>CNI_COMMAND=ADD</strong> — 操作（可选值: ADD/DEL/CHECK）</li><li><strong>CNI_CONTAINER=pause_demo</strong> — 我们告诉 CNI 插件在名为 <strong>pause_demo</strong> 的 network namespace 进行操作。</li><li><strong>CNI_NETNS=/var/run/netns/pause_demo</strong> — namespace 文件所在的路径。</li><li><strong>CNI_IFNAME=eth10</strong> — 希望在容器中设置的网络接口名称。</li><li><strong>CNI_PATH=<code>pwd</code></strong> — 告诉 CNI 插件可执行文件所在的路径，由于我们当前正好在 CNI 插件的目录中，因此可以使用 <code>pwd</code> 获取路径。</li></ul><blockquote><p>我强烈建议你阅读 CNI 规范以获取有关插件及其功能的更多信息。你可以在同一个 JSON 文件中使用多个插件执行一系列操作，例如添加防火墙规则等等。</p></blockquote><p>第 5 步：运行上述命令会返回一些内容。首先，会返回一个错误，因为 IPAM 驱动程序找不到它用来在本地存储 IP 信息的文件。如果我们为不同的 network namespace 再次运行该命令时，将不会收到此错误，因为该文件是在第一次运行插件时创建的。其次，我们可以得到一个 JSON 对象，表明了插件配置的相关 IP 配置。在本例中，网桥的 IP 地址应当被设置为 10.0.10.1/24，容器接口的 IP 地址应当被设置为 10.0.10.2/24，在容器中还添加了我们在 JSON 配置文件中定义的默认路由和 1.1.1.1/32 的路由。让我们看看它做了什么。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pause_demo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ifconfig</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">eth10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     Link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> encap:Ethernet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  HWaddr</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">a:58:0a:00:0a:02</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          inet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr:10.0.10.2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Bcast:0.0.0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Mask:255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> BROADCAST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RUNNING</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MULTICAST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  MTU:1500</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Metric:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> frame:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          TX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> carrier:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          collisions:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> txqueuelen:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes:1476</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (1.4 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">KB</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  TX bytes:0 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">lo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        Link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> encap:Local</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Loopback</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          inet</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> addr:127.0.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Mask:255.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          UP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LOOPBACK</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RUNNING</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  MTU:65536</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Metric:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> frame:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          TX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packets:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> errors:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dropped:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> overruns:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> carrier:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          collisions:0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> txqueuelen:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">          RX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bytes:0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)  TX bytes:0 (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> B</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> netns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pause_demo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> route</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.10.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eth10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1.1.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> via</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.10.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eth10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">10.0.10.0/24</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eth10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  proto</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  scope</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> link</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  src</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.10.2</span></span></code></pre></div><p>第 6 步：启动 Web 服务容器与 <strong>pause</strong> 容器共享 namespace。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> web_demo</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --network</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> container:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$container_id </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8fadcf2925b779de6781b4215534b32231685b8515f998b2a66a3c7e38333e30</span></span></code></pre></div><p>第 7 步：使用 pause 容器的 IP 地址来访问 Web 服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">controlplane</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/lib/cni/networks/demo_br/last_reserved_ip`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">DOCTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    body</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        width:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 35</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">em</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        margin:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> auto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        font-family:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Tahoma,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Verdana,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Arial,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sans-serif</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Welcome to nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">1&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">If you see this page, the nginx web server is successfully installed and</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">working.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Further</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> required.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">For online documentation and support please refer to</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.org/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.org</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">br/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Commercial</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> support</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> available</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">a href=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;http://nginx.com/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nginx.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">p&gt;&lt;em</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Thank you </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> using nginx.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/em&gt;&lt;/p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span></code></pre></div><p>现在让我们看看下一节中 Pod 的定义。</p><h2 id="pod-网络命名空间" tabindex="-1">Pod 网络命名空间 <a class="header-anchor" href="#pod-网络命名空间" aria-label="Permalink to &quot;Pod 网络命名空间&quot;">​</a></h2><p>在 Kubernetes 中首先要理解的是，<strong>Pod</strong> 实际上并不等同于容器，而是容器的集合。并且这些同一个集合的容器都共享一个网络堆栈。Kubernetes 通过在 <strong>pause</strong> 容器上设置网络来进行管理，你可以在创建的每个 Pod 中找到它。pause 容器本身只负责提供网络，所有其他的容器都连接到 pause 容器所在的网络。因此，在同一个 Pod 中的一个容器也可以通过 localhost 与另一个容器中的服务进行通信。</p><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/20220420205102.png" alt=""></p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li>[1] 原文链接: <a href="https://medium.com/@dramasamy/life-of-a-packet-in-kubernetes-part-1-f9bc0909e051" target="_blank" rel="noreferrer">https://medium.com/@dramasamy/life-of-a-packet-in-kubernetes-part-1-f9bc0909e051</a></li><li>[2] Docker 官网: <a href="https://docs.docker.com/network/iptables/#docker-on-a-router" target="_blank" rel="noreferrer">https://docs.docker.com/network/iptables/#docker-on-a-router</a></li><li>[3] CNI 规范: <a href="https://github.com/containernetworking/cni/blob/master/SPEC.md" target="_blank" rel="noreferrer">https://github.com/containernetworking/cni/blob/master/SPEC.md</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-fd9366c1 data-v-6f2fb8d9><!--[--><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-6f2fb8d9><div class="edit-link" data-v-6f2fb8d9><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/cr7258/cr7258.github.io/edit/main/docs/blogs/translate/2023/01-life-of-a-packet-in-kubernetes-part-1.md" target="_blank" rel="noreferrer" data-v-6f2fb8d9><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-6f2fb8d9><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 不妥之处，敬请雅正<!--]--></a></div><div class="last-updated" data-v-6f2fb8d9><p class="VPLastUpdated" data-v-6f2fb8d9 data-v-fd14ea0d>最后更新: <time datetime="2024-02-06T13:56:38.000Z" data-v-fd14ea0d></time></p></div></div><nav class="prev-next" data-v-6f2fb8d9><div class="pager" data-v-6f2fb8d9><!----></div><div class="pager" data-v-6f2fb8d9><a class="VPLink link pager-link next" href="/blogs/translate/2023/07-git-cheat-sheet-3" data-v-6f2fb8d9><!--[--><span class="desc" data-v-6f2fb8d9>下一篇</span><span class="title" data-v-6f2fb8d9><div class="text-color-red mr-[6px]" style="font-weight: 550; display: inline-block;">1</div>Git 速查表：专家必备的 14 个 Git 命令</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div id="comment-container"></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_index.md\":\"CN-4406z\",\"about_me.md\":\"Ckmt6Mhx\",\"archives.md\":\"C4mBJfcL\",\"blogs_original_2022_01-kubernetes-setup.md\":\"CyWp27Cb\",\"blogs_original_2022_02-kubectl-debug.md\":\"Zd-47A4s\",\"blogs_original_2022_03-finalizer.md\":\"Bc9FjK3x\",\"blogs_original_2022_04-kubeasz.md\":\"CF08uUd3\",\"blogs_original_2022_05-docker-rootless.md\":\"DLX0drop\",\"blogs_original_2022_06-kafka-setup.md\":\"B0ZPEnuC\",\"blogs_original_2022_07-kafka-big-message.md\":\"_TSmRm_z\",\"blogs_original_2022_08-reset-kafka-consumer-offset.md\":\"B4KPHA4R\",\"blogs_original_2022_09-pulsar.md\":\"CYeXAE8y\",\"blogs_original_2022_10-harbor.md\":\"DgVUS1si\",\"blogs_original_2022_11.nebula.md\":\"l4DJILY4\",\"blogs_original_2022_12.lru.md\":\"DUfPhlXt\",\"blogs_original_2022_13-envoy-quickstart.md\":\"D68_FK1v\",\"blogs_original_2023_01-argocd-quickstart.md\":\"BEILT8Gx\",\"blogs_original_2023_02-wasm-in-cloud-native.md\":\"F4JN7csX\",\"blogs_original_2023_03-kubectl-patch.md\":\"CKH9APbd\",\"blogs_original_2023_04-kubernetes-keycloak-oidc.md\":\"C-2KNUwH\",\"blogs_original_2023_05-kubernetes-multi-cluster-1.md\":\"BwftGayn\",\"blogs_original_2023_06-kubernetes-multi-cluster-2.md\":\"Dg3EuBRQ\",\"blogs_original_2023_07-vcluster.md\":\"Bd0XQaXq\",\"blogs_original_2023_08-cilium-cluster-mesh.md\":\"BLRYUvzu\",\"blogs_original_2023_09-clusterresourceset.md\":\"xdYD9E9B\",\"blogs_original_2023_10-cilium-bgp.md\":\"ByEzYTOv\",\"blogs_original_2024_01-crossplane.md\":\"QsrDKe0D\",\"blogs_original_2024_02-sidecar-containers.md\":\"DFtuB9EH\",\"blogs_original_2024_03-higress-ai-plugins.md\":\"ULbVxojk\",\"blogs_original_2025_01-mcp.md\":\"BC2ryTfQ\",\"blogs_original_2025_02-elasticsearch-mcp-server.md\":\"DEV4oSXc\",\"blogs_original_2025_03-mcp-client.md\":\"kSZD-d3m\",\"blogs_original_2025_04-mcp-sse.md\":\"Il90aBc6\",\"blogs_original_2025_05-higress-vs-oneapi.md\":\"Bz_oFpxo\",\"blogs_original_2025_06-higress-ai-gateway.md\":\"tlOIOFMB\",\"blogs_original_2025_07-deepseek-flashmla.md\":\"CNe0Xwb-\",\"blogs_original_2025_08-deepseek-deepep.md\":\"COUsLCH0\",\"blogs_original_2025_09-deepseek-deepgemm.md\":\"DLi0QH0Q\",\"blogs_original_2025_10-deepseek-parallelism.md\":\"VCRLjZfJ\",\"blogs_original_2025_11-deepseek-3fs.md\":\"DOSDdici\",\"blogs_original_2025_12-manus-ai.md\":\"Cposukn9\",\"blogs_original_2025_13-gpu-kind-cluster.md\":\"M2leRJcB\",\"blogs_original_index.md\":\"DIl9hkHi\",\"blogs_translate_2023_01-life-of-a-packet-in-kubernetes-part-1.md\":\"BaZV78NJ\",\"blogs_translate_2023_02-life-of-a-packet-in-kubernetes-part-2.md\":\"C73nvQmO\",\"blogs_translate_2023_03-life-of-a-packet-in-kubernetes-part-3.md\":\"Dyp69ltB\",\"blogs_translate_2023_04-life-of-a-packet-in-kubernetes-part-4.md\":\"C68Fvqkn\",\"blogs_translate_2023_05-git-cheat-sheet-1.md\":\"D67Ho67m\",\"blogs_translate_2023_06-git-cheat-sheet-2.md\":\"Bwdva5Lc\",\"blogs_translate_2023_07-git-cheat-sheet-3.md\":\"DgrbbRm-\",\"blogs_translate_index.md\":\"DYyRG9fA\",\"categories_fragments_index.md\":\"DQnMKfOf\",\"categories_fragments_个人速查手册_01-git.md\":\"Bh66x8CQ\",\"categories_fragments_个人速查手册_02-find-docker-file.md\":\"CRRUCGXS\",\"categories_fragments_个人速查手册_03-idea-shortcut.md\":\"CfzAoQyv\",\"categories_fragments_个人速查手册_04-ssh-proxy.md\":\"DwrvIR9t\",\"categories_fragments_个人速查手册_05-docker-command.md\":\"CqzOQ1IO\",\"categories_fragments_个人速查手册_06-kubernetes-command.md\":\"B2lIyfQ1\",\"categories_issues_bug万象集_ 01-ebpf.md\":\"Bb6RN0S4\",\"categories_issues_bug万象集_02-ide.md\":\"m2LbXTgv\",\"categories_issues_index.md\":\"8iAcUPz7\",\"categories_learning_ai_01-ai.md\":\"Dmdx-iNu\",\"categories_learning_ai_02-gpu.md\":\"D0Bl7OyD\",\"categories_learning_ai_03-pytorch.md\":\"DqLJK_cp\",\"categories_learning_ai_04-mcp.md\":\"BNLv_SBe\",\"categories_learning_ai_05-ai-gateway.md\":\"DQtxN5LV\",\"categories_learning_ebpf_01-ebpf.md\":\"BBnjcc8p\",\"categories_learning_ebpf_02-bpftool.md\":\"DUQ1ZCES\",\"categories_learning_index.md\":\"DvDHI_1T\",\"categories_learning_云原生_01-istio.md\":\"Cu5TWGXY\",\"categories_learning_云原生_02-observability.md\":\"B92HvkyD\",\"categories_learning_编程语言_01-rust.md\":\"BrK4XiNI\",\"categories_learning_编程语言_02-golang-concurrency.md\":\"BDop-dGy\",\"categories_learning_编程语言_02-golang-gmp.md\":\"Ciz3BvK_\",\"categories_learning_编程语言_03-design-pattern.md\":\"CiYq4Oyx\",\"categories_open-source_index.md\":\"BLPVMCB9\",\"categories_open-source_开源项目_01-ai.md\":\"Hp7pRVWd\",\"categories_open-source_开源项目_02-web.md\":\"BPZadmAM\",\"categories_open-source_开源项目_03-mcp.md\":\"DbwTp_ha\",\"categories_open-source_开源项目_04-cloud-native.md\":\"DKFZ7Stm\",\"categories_tools_index.md\":\"BlAxgLyO\",\"categories_tools_云原生_01-k8s-resource.md\":\"CT5Vh8Zu\",\"categories_tools_编程工具_01-windsurf.md\":\"DqwVTsT8\",\"courses_algorithm_index.md\":\"DL2v5ZJd\",\"courses_algorithm_算法_01-hot100.md\":\"CQtjuUbo\",\"courses_algorithm_算法_02-template.md\":\"d6RW2dbY\",\"courses_algorithm_算法_03-design-problem.md\":\"ByfGq922\",\"courses_elastic-stack_elastic stack 实战教程_01-quick-start.md\":\"CfYtolT_\",\"courses_elastic-stack_elastic stack 实战教程_02-ilm.md\":\"Bf4LURsh\",\"courses_elastic-stack_elastic stack 实战教程_03-snapshot.md\":\"B1A5VFFa\",\"courses_elastic-stack_elastic stack 实战教程_04-fleet.md\":\"BZhqpn4S\",\"courses_elastic-stack_elastic stack 实战教程_05-java-client.md\":\"CTqfA71L\",\"courses_elastic-stack_index.md\":\"YjCR02KJ\",\"courses_interview_ai_01-ai.md\":\"DTY4LyUH\",\"courses_interview_elastic stack_01-elasticsearch.md\":\"ChcOR-XJ\",\"courses_interview_index.md\":\"Dv7iqy0H\",\"courses_interview_云原生_01-kubernetes.md\":\"Bc1bvVQs\",\"courses_interview_云原生_02-container.md\":\"DCK_2WlB\",\"courses_interview_云原生_03-storage.md\":\"RpjVN9wd\",\"courses_interview_云原生_04-network.md\":\"DWMbRrfZ\",\"courses_interview_云原生_05-security.md\":\"DBDwV8Lq\",\"courses_interview_云原生_06-rollout.md\":\"D5pbv9CM\",\"courses_interview_云原生_07-operator.md\":\"CNU54vx4\",\"courses_interview_大数据_01-message-queue.md\":\"0ugR0yAk\",\"courses_interview_操作系统_01-cpu.md\":\"BqHZkJrj\",\"courses_interview_操作系统_02-memory.md\":\"CcFAxwGK\",\"courses_interview_操作系统_03-storage.md\":\"SybRwsm0\",\"courses_interview_操作系统_04-network.md\":\"D2FXpnoB\",\"courses_interview_操作系统_05-cgroup.md\":\"C-SElBaK\",\"courses_interview_编程语言_01-golang.md\":\"CioDvBoO\",\"courses_interview_编程语言_02-algorithm.md\":\"BaIO-gVX\",\"en_about_index.md\":\"ozu2McxY\",\"en_about_me.md\":\"Daxj9jc2\",\"en_archives.md\":\"QxJ8M4fc\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_01-quick-start.md\":\"D_mzGvWH\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_02-ilm.md\":\"D0X-4e3N\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_03-snapshot.md\":\"DaophLj2\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_04-fleet.md\":\"NJMFKbPh\",\"en_courses_elastic-stack_01-elastic-stack-hands-on-lab_05-java-client.md\":\"BMoD6qZg\",\"en_courses_elastic-stack_index.md\":\"CBzDdSnC\",\"en_index.md\":\"BTQJREMa\",\"en_tags.md\":\"DF7l3MND\",\"index.md\":\"BUT7y72g\",\"meetup_network_01-network_01-cni.md\":\"CtwWwJhI\",\"meetup_network_index.md\":\"CQni9TeU\",\"tags.md\":\"Dk6GPH1S\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Se7en的架构笔记\",\"description\":\"个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"博客\",\"items\":[{\"text\":\"原创\",\"link\":\"/blogs/original/index\",\"activeMatch\":\"/blogs/original/\"},{\"text\":\"翻译\",\"link\":\"/blogs/translate/index\",\"activeMatch\":\"/blogs/translate/\"}],\"activeMatch\":\"/blogs/\"},{\"text\":\"我的分类\",\"items\":[{\"text\":\"Bug万象集\",\"link\":\"/categories/issues/index\",\"activeMatch\":\"/categories/issues/\"},{\"text\":\"个人速查手册\",\"link\":\"/categories/fragments/index\",\"activeMatch\":\"/categories/fragments/\"},{\"text\":\"精选工具箱\",\"link\":\"/categories/tools/index\",\"activeMatch\":\"/categories/tools/\"},{\"text\":\"开源项目\",\"link\":\"/categories/open-source/index\",\"activeMatch\":\"/categories/open-source/\"},{\"text\":\"学习笔记\",\"link\":\"/categories/learning/index\",\"activeMatch\":\"/categories/learning/\"}],\"activeMatch\":\"/categories/\"},{\"text\":\"我的小册\",\"items\":[{\"text\":\"Elastic Stack 实战教程\",\"link\":\"/courses/elastic-stack/index\",\"activeMatch\":\"/courses/elastic-stack/\"},{\"text\":\"面试宝典\",\"link\":\"/courses/interview/index\",\"activeMatch\":\"/courses/interview/\"},{\"text\":\"数据结构与算法\",\"link\":\"/courses/algorithm/index\",\"activeMatch\":\"/courses/algorithm/\"}],\"activeMatch\":\"/courses/\"},{\"text\":\"我的标签\",\"link\":\"/tags\",\"activeMatch\":\"/tags\"},{\"text\":\"我的归档\",\"link\":\"/archives\",\"activeMatch\":\"/archives\"},{\"text\":\"关于\",\"items\":[{\"text\":\"关于知识库\",\"link\":\"/about/index\",\"activeMatch\":\"/about/index\"},{\"text\":\"关于我\",\"link\":\"/about/me\",\"activeMatch\":\"/about/me\"}],\"activeMatch\":\"/about/\"}],\"sidebar\":{\"/categories/issues/\":[{\"text\":\"Bug万象集 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>eBPF\",\"link\":\"/categories/issues/Bug万象集/ 01-ebpf\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>IDE\",\"link\":\"/categories/issues/Bug万象集/02-ide\"}],\"collapsed\":false}],\"/categories/fragments/\":[{\"text\":\"个人速查手册 (6篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Git 速查手册\",\"link\":\"/categories/fragments/个人速查手册/01-git\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>5 种快速查找容器中文件的方法\",\"link\":\"/categories/fragments/个人速查手册/02-find-docker-file\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>IDEA 快捷键\",\"link\":\"/categories/fragments/个人速查手册/03-idea-shortcut\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>使用 ClashX 代理 SSH 连接\",\"link\":\"/categories/fragments/个人速查手册/04-ssh-proxy\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Docker 常用命令\",\"link\":\"/categories/fragments/个人速查手册/05-docker-command\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>Kubernetes 常用命令\",\"link\":\"/categories/fragments/个人速查手册/06-kubernetes-command\"}],\"collapsed\":false}],\"/categories/tools/\":[{\"text\":\"云原生 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>查询 Kubernetes 核心资源字段\",\"link\":\"/categories/tools/云原生/01-k8s-resource\"}],\"collapsed\":false},{\"text\":\"编程工具 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Windsurf 下一代 AI IDE\",\"link\":\"/categories/tools/编程工具/01-windsurf\"}],\"collapsed\":false}],\"/categories/learning/\":[{\"text\":\"AI (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/categories/learning/AI/01-ai\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>GPU\",\"link\":\"/categories/learning/AI/02-gpu\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>PyTorch\",\"link\":\"/categories/learning/AI/03-pytorch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Model Context Protocol（MCP）\",\"link\":\"/categories/learning/AI/04-mcp\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>AI Gateway\",\"link\":\"/categories/learning/AI/05-ai-gateway\"}],\"collapsed\":false},{\"text\":\"eBPF (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>eBPF 基础\",\"link\":\"/categories/learning/eBPF/01-ebpf\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>bpftool\",\"link\":\"/categories/learning/eBPF/02-bpftool\"}],\"collapsed\":false},{\"text\":\"云原生 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Istio\",\"link\":\"/categories/learning/云原生/01-istio\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Observability\",\"link\":\"/categories/learning/云原生/02-observability\"}],\"collapsed\":false},{\"text\":\"编程语言 (4篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Rust\",\"link\":\"/categories/learning/编程语言/01-rust\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Go 并发编程\",\"link\":\"/categories/learning/编程语言/02-golang-concurrency\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Go GMP\",\"link\":\"/categories/learning/编程语言/02-golang-gmp\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>设计模式\",\"link\":\"/categories/learning/编程语言/03-design-pattern\"}],\"collapsed\":false}],\"/categories/open-source/\":[{\"text\":\"开源项目 (4篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/categories/open-source/开源项目/01-ai\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Web\",\"link\":\"/categories/open-source/开源项目/02-web\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>MCP\",\"link\":\"/categories/open-source/开源项目/03-mcp\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>云原生\",\"link\":\"/categories/open-source/开源项目/04-cloud-native\"}],\"collapsed\":false}],\"/blogs/original/\":[{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/snake.svg\\\" title=\\\"蛇年\\\" alt=\\\"生肖\\\">\\n            2025年 (13篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>一键部署 GPU Kind 集群，体验 vLLM 极速推理\",\"link\":\"/blogs/original//2025/13-gpu-kind-cluster\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Manus 刷屏，全网求邀请码！这款 AI Agent 究竟有多强？\",\"link\":\"/blogs/original//2025/12-manus-ai\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>DeepSeek 开源周第五弹：3FS —— 专为 AI 训练和推理设计的分布式存储\",\"link\":\"/blogs/original//2025/11-deepseek-3fs\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>DeepSeek 开源周第四弹：DualPipe 和 EPLB —— 优化并行策略\",\"link\":\"/blogs/original//2025/10-deepseek-parallelism\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>DeepSeek 开源周第三弹：DeepGEMM —— 高效的 FP8 GEMM 库，核心代码仅 300 行！\",\"link\":\"/blogs/original//2025/09-deepseek-deepgemm\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>DeepSeek 开源周第二弹：DeepEP —— 首个 MoE 模型训练和推理的 EP 通信库\",\"link\":\"/blogs/original//2025/08-deepseek-deepep\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>DeepSeek 开源周第一弹：FlashMLA —— 大模型推理的“涡轮增压器”\",\"link\":\"/blogs/original//2025/07-deepseek-flashmla\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>提升 AI 服务的稳定性：Higress AI 网关的降级功能介绍\",\"link\":\"/blogs/original//2025/06-higress-ai-gateway\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>AI 网关对决：Higress 与 OneAPI 的功能对比\",\"link\":\"/blogs/original//2025/05-higress-vs-oneapi\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>构建基于 SSE 协议通信的 MCP Server 和 Client\",\"link\":\"/blogs/original//2025/04-mcp-sse\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">11</div>快速上手：实现你的第一个 MCP Client\",\"link\":\"/blogs/original//2025/03-mcp-client\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">12</div>MCP Server 开发实战：无缝对接 LLM 和 Elasticsearch\",\"link\":\"/blogs/original//2025/02-elasticsearch-mcp-server\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">13</div>一文带你入门 MCP（模型上下文协议）\",\"link\":\"/blogs/original//2025/01-mcp\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/dragon.svg\\\" title=\\\"龙年\\\" alt=\\\"生肖\\\">\\n            2024年 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Higress AI 插件对接通义千问大语言模型\",\"link\":\"/blogs/original//2024/03-higress-ai-plugins\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>深入剖析 Kubernetes 原生 Sidecar 容器\",\"link\":\"/blogs/original//2024/02-sidecar-containers\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Crossplane 实战：构建统一的云原生控制平面\",\"link\":\"/blogs/original//2024/01-crossplane\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/rabbit.svg\\\" title=\\\"兔年\\\" alt=\\\"生肖\\\">\\n            2023年 (10篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Containerlab + Kind 快速部署 Cilium BGP 环境\",\"link\":\"/blogs/original//2023/10-cilium-bgp\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>使用 ClusterResourceSet 为 Cluster API 集群自动安装 CNI 插件\",\"link\":\"/blogs/original//2023/09-clusterresourceset\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Cilium 多集群 Cluster Mesh 介绍\",\"link\":\"/blogs/original//2023/08-cilium-cluster-mesh\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>vCluster -- 基于虚拟集群的多租户方案\",\"link\":\"/blogs/original//2023/07-vcluster\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Kubernetes 多集群网络方案系列 2 -- Submariner 监控\",\"link\":\"/blogs/original//2023/06-kubernetes-multi-cluster-2\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>Kubernetes 多集群网络方案系列 1 -- Submariner 介绍\",\"link\":\"/blogs/original//2023/05-kubernetes-multi-cluster-1\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>在 Kubernetes 中使用 Keycloak OIDC Provider 对用户进行身份验证\",\"link\":\"/blogs/original//2023/04-kubernetes-keycloak-oidc\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>使用 Kubectl Patch 命令更新资源\",\"link\":\"/blogs/original//2023/03-kubectl-patch\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>WebAssembly 在云原生中的实践指南\",\"link\":\"/blogs/original//2023/02-wasm-in-cloud-native\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>ArgoCD 简明教程\",\"link\":\"/blogs/original//2023/01-argocd-quickstart\"}],\"collapsed\":false},{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/tiger.svg\\\" title=\\\"虎年\\\" alt=\\\"生肖\\\">\\n            2022年 (13篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>使用 Envoy 作为前端代理\",\"link\":\"/blogs/original//2022/13-envoy-quickstart\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>实现 LRU 缓存算法\",\"link\":\"/blogs/original//2022/12.lru\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Nebula 分布式图数据库介绍\",\"link\":\"/blogs/original//2022/11.nebula\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Habor 部署指南\",\"link\":\"/blogs/original//2022/10-harbor\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Pulsar 介绍与部署\",\"link\":\"/blogs/original//2022/09-pulsar\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>如何重置 Kafka 中的 Consumer Offset？\",\"link\":\"/blogs/original//2022/08-reset-kafka-consumer-offset\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>如何往 Kafka 发送大消息？\",\"link\":\"/blogs/original//2022/07-kafka-big-message\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">8</div>Kafka 生产环境部署指南\",\"link\":\"/blogs/original//2022/06-kafka-setup\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">9</div>Docker Rootless 在非特权模式下运行 Docker\",\"link\":\"/blogs/original//2022/05-docker-rootless\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">10</div>使用 ezctl 工具部署和管理 Kubernetes 集群\",\"link\":\"/blogs/original//2022/04-kubeasz\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">11</div>Kubernetes 中的对象是如何删除的：Finalizers 字段介绍\",\"link\":\"/blogs/original//2022/03-finalizer\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">12</div>Kubectl debug 调试容器\",\"link\":\"/blogs/original//2022/02-kubectl-debug\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">13</div>Kubenetes 高可用集群搭建\",\"link\":\"/blogs/original//2022/01-kubernetes-setup\"}],\"collapsed\":false}],\"/blogs/translate/\":[{\"text\":\"<img class=\\\"chinese-zodiac\\\" style=\\\"position: static; vertical-align: middle; padding-bottom: 3px;\\\" src=\\\"/img/svg/chinese-zodiac/rabbit.svg\\\" title=\\\"兔年\\\" alt=\\\"生肖\\\">\\n            2023年 (7篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Git 速查表：专家必备的 14 个 Git 命令\",\"link\":\"/blogs/translate//2023/07-git-cheat-sheet-3\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>Git 速查表：中级用户必备的 12 个 Git 命令\",\"link\":\"/blogs/translate//2023/06-git-cheat-sheet-2\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>Git 速查表：初学者必备的 12 个 Git 命令\",\"link\":\"/blogs/translate//2023/05-git-cheat-sheet-1\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>Kubernetes 中数据包的生命周期 -- 第 4 部分\",\"link\":\"/blogs/translate//2023/04-life-of-a-packet-in-kubernetes-part-4\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Kubernetes 中数据包的生命周期 -- 第 3 部分\",\"link\":\"/blogs/translate//2023/03-life-of-a-packet-in-kubernetes-part-3\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>Kubernetes 中数据包的生命周期 -- 第 2 部分\",\"link\":\"/blogs/translate//2023/02-life-of-a-packet-in-kubernetes-part-2\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>Kubernetes 中数据包的生命周期 -- 第 1 部分\",\"link\":\"/blogs/translate//2023/01-life-of-a-packet-in-kubernetes-part-1\"}],\"collapsed\":false}],\"/courses/elastic-stack/\":[{\"text\":\"Elastic Stack 实战教程 (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Elastic Stack 8 快速上手\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/01-quick-start\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>ILM 索引生命周期管理\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/02-ilm\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>快照备份与恢复\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/03-snapshot\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>使用 Fleet 管理 Elastic Agent 监控应用\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/04-fleet\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>Elasticsearch Java API Client 开发\",\"link\":\"/courses/elastic-stack/Elastic Stack 实战教程/05-java-client\"}],\"collapsed\":false}],\"/courses/interview/\":[{\"text\":\"AI (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>AI\",\"link\":\"/courses/interview/AI/01-ai\"}],\"collapsed\":false},{\"text\":\"Elastic Stack (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Elasticsearch\",\"link\":\"/courses/interview/Elastic Stack/01-elasticsearch\"}],\"collapsed\":false},{\"text\":\"云原生 (7篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Kubernetes\",\"link\":\"/courses/interview/云原生/01-kubernetes\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>容器\",\"link\":\"/courses/interview/云原生/02-container\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>存储\",\"link\":\"/courses/interview/云原生/03-storage\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>网络\",\"link\":\"/courses/interview/云原生/04-network\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>安全\",\"link\":\"/courses/interview/云原生/05-security\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">6</div>发布\",\"link\":\"/courses/interview/云原生/06-rollout\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">7</div>Operator\",\"link\":\"/courses/interview/云原生/07-operator\"}],\"collapsed\":false},{\"text\":\"大数据 (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>消息队列\",\"link\":\"/courses/interview/大数据/01-message-queue\"}],\"collapsed\":false},{\"text\":\"操作系统 (5篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>CPU\",\"link\":\"/courses/interview/操作系统/01-cpu\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>内存\",\"link\":\"/courses/interview/操作系统/02-memory\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>存储\",\"link\":\"/courses/interview/操作系统/03-storage\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">4</div>网络\",\"link\":\"/courses/interview/操作系统/04-network\"},{\"text\":\"<div class=\\\"text-color-gray mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">5</div>cgroup\",\"link\":\"/courses/interview/操作系统/05-cgroup\"}],\"collapsed\":false},{\"text\":\"编程语言 (2篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Golang\",\"link\":\"/courses/interview/编程语言/01-golang\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>数据结构与算法\",\"link\":\"/courses/interview/编程语言/02-algorithm\"}],\"collapsed\":false}],\"/courses/algorithm/\":[{\"text\":\"算法 (3篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>Hot 100 算法题\",\"link\":\"/courses/algorithm/算法/01-hot100\"},{\"text\":\"<div class=\\\"text-color-orange mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">2</div>算法解题套路框架\",\"link\":\"/courses/algorithm/算法/02-template\"},{\"text\":\"<div class=\\\"text-color-yellow mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">3</div>经典设计问题\",\"link\":\"/courses/algorithm/算法/03-design-problem\"}],\"collapsed\":false}],\"/meetup/network/\":[{\"text\":\"network (1篇)\",\"items\":[{\"text\":\"<div class=\\\"text-color-red mr-[6px]\\\" style=\\\"font-weight: 550; display: inline-block;\\\">1</div>CNI (Container Network Interface)\",\"link\":\"/meetup/network/01-network/01-cni\"}],\"collapsed\":false}]},\"sidebarCollapsible\":false,\"logo\":\"/logo.png\",\"outline\":{\"level\":\"deep\",\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"editLink\":{\"pattern\":\"https://github.com/cr7258/cr7258.github.io/edit/main/docs/:path\",\"text\":\"不妥之处，敬请雅正\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/cr7258/cr7258.github.io\"}],\"articleMetadataConfig\":{\"author\":\"Se7en\",\"authorLink\":\"/about/me\",\"showViewCount\":false},\"copyrightConfig\":{\"license\":\"署名-相同方式共享 4.0 国际 (CC BY-SA 4.0)\",\"licenseLink\":\"http://creativecommons.org/licenses/by-sa/4.0/\"},\"commentConfig\":{\"type\":\"gitalk\",\"showComment\":true},\"footerConfig\":{\"showFooter\":true,\"copyright\":\"Copyright  2023-2025 Se7en\"}},\"locales\":{\"root\":{\"label\":\"中文\",\"lang\":\"zh\"},\"en\":{\"label\":\"English\",\"lang\":\"en\"}},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>
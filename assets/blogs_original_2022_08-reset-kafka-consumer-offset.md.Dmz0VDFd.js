import{_ as l}from"./chunks/ArticleMetadata.BGfgJEkN.js";import{_ as k,C as o,c as r,o as e,k as n,G as d,P as c,a as F,w as g,b as C,e as u}from"./chunks/framework.hsaHFr3N.js";import"./chunks/md5.Csn9Gkkw.js";const O=JSON.parse('{"title":"如何重置 Kafka 中的 Consumer Offset？","description":"","frontmatter":{"title":"如何重置 Kafka 中的 Consumer Offset？","author":"Se7en","date":"2022/05/06 20:00","categories":["原创"],"tags":["Kafka"]},"headers":[],"relativePath":"blogs/original/2022/08-reset-kafka-consumer-offset.md","filePath":"blogs/original/2022/08-reset-kafka-consumer-offset.md","lastUpdated":1707227798000}'),y={name:"blogs/original/2022/08-reset-kafka-consumer-offset.md"};function f(i,s,m,b,D,v){const h=l,p=o("ClientOnly");return e(),r("div",null,[s[0]||(s[0]=n("h1",{id:"如何重置-kafka-中的-consumer-offset",tabindex:"-1"},[F("如何重置 Kafka 中的 Consumer Offset？ "),n("a",{class:"header-anchor",href:"#如何重置-kafka-中的-consumer-offset","aria-label":'Permalink to "如何重置 Kafka 中的 Consumer Offset？"'},"​")],-1)),d(p,null,{default:g(()=>{var a,t;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((t=i.$frontmatter)==null?void 0:t.showArticleMetadata)??!0)?(e(),C(h,{key:0,article:i.$frontmatter},null,8,["article"])):u("",!0)]}),_:1}),s[1]||(s[1]=c(`<h2 id="获取-consumer-offset" tabindex="-1">获取 Consumer Offset <a class="header-anchor" href="#获取-consumer-offset" aria-label="Permalink to &quot;获取 Consumer Offset&quot;">​</a></h2><p>使用 <code>kafka-consumer-groups.sh</code> 命令加上 group id 和 describe 参数查询对应 consumer group 的消费进度。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    --describe</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 返回结果</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">GROUP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           TOPIC</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           PARTITION</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  CURRENT-OFFSET</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  LOG-END-OFFSET</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  LAG</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">             CONSUMER-ID</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            CLIENT-ID</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">my-group</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      0</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">          5509</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">            5515</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">            6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">               rdkafka-39404560-f8f2-4b0b</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /151.62.82.140</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  rdkafka</span></span></code></pre></div><p><code>CURRENT-OFFSET</code> 表示 consumer group 在分区当前消费到的偏移量， <code>LOG-END-OFFSET</code> 指的是分区中最新生产的消息的偏移量，<code>LAG</code> 的值等于  LOG-END-OFFSET -  CURRENT-OFFSET，表示 consumer 消费滞后区间，正常情况下 LAG 的值应当比较小，如果过大说明消费跟不上生产速度，需要引起注意。</p><p>consumer group 可以使用以下命令查询。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   --list</span></span></code></pre></div><h2 id="修改-consumer-offset" tabindex="-1">修改 Consumer Offset <a class="header-anchor" href="#修改-consumer-offset" aria-label="Permalink to &quot;修改 Consumer Offset&quot;">​</a></h2><p>使用 <code>kafka-consumer-groups.sh</code> 命令指定 topic, consumer group，使用 <code>–reset-offsets</code> 参数修改偏移量。如下所示，将 <code>test-topic</code> topic 中 <code>my-group</code> consumer group 的偏移量重置为 topic 中最早的偏移量。此命令将会重置 <code>my-group</code> consumer group 在 <code>test-topic </code> topic 中所有 partition 的偏移量，如果想要重置 topic 中指定的 partition 的偏移量，可以通过 <code>--topic &lt;topicname&gt;:&lt;partition&gt;</code> 的方式设置，例如 --topic test-topic:0 表示只重置 <code>test-topic</code> topic 中 0 分区的偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--to-earliest</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h2 id="consumer-offset-参数" tabindex="-1">Consumer Offset 参数 <a class="header-anchor" href="#consumer-offset-参数" aria-label="Permalink to &quot;Consumer Offset 参数&quot;">​</a></h2><p><code>–reset-offsets</code> 参数有以下几个选项可供选择：</p><ul><li><code>--to-earliest</code>：重置为 topic 中最早的偏移量。</li><li><code>--to-latest</code>：重置为 topic 中最新的偏移量。</li><li><code>--to-offset</code>：重置为指定的偏移量。</li><li><code>--shift-by</code>：相对当前偏移量前后移动偏移量。</li><li><code>--to-datetime</code>：根据时间戳重置偏移量。</li></ul><h3 id="to-earliest" tabindex="-1">--to-earliest <a class="header-anchor" href="#to-earliest" aria-label="Permalink to &quot;--to-earliest&quot;">​</a></h3><p><code>--to-earliest</code> 参数重置为 topic 中最早的偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--to-earliest</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h3 id="to-latest" tabindex="-1">--to-latest <a class="header-anchor" href="#to-latest" aria-label="Permalink to &quot;--to-latest&quot;">​</a></h3><p><code>--to-earliest</code> 参数重置为 topic 中最新的偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--to-latest</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h3 id="to-offset" tabindex="-1">--to-offset <a class="header-anchor" href="#to-offset" aria-label="Permalink to &quot;--to-offset&quot;">​</a></h3><p><code>--to-offset</code> 参数重置为指定的偏移量，后面跟正整数。如下所示，将偏移量重置为 5510。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--to-offset</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5510</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h3 id="shift-by" tabindex="-1">--shift-by <a class="header-anchor" href="#shift-by" aria-label="Permalink to &quot;--shift-by&quot;">​</a></h3><p><code>--shift-by</code> 参数相对当前偏移量前后移动偏移量，后面可以跟正整数或负整数。如下所示，相对当前偏移量 +10 重置偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--shift-by</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><p>如下所示，相对当前偏移量 -10 重置偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--shift-by</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -10</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h3 id="to-datetime" tabindex="-1">--to-datetime <a class="header-anchor" href="#to-datetime" aria-label="Permalink to &quot;--to-datetime&quot;">​</a></h3><p><code>--to-datetime</code> 参数根据时间戳重置偏移量，后面跟 <strong>YYYY-MM-DDTHH:mm:SS.sss</strong> 格式的时间戳。如下所示，将偏移量重置到 2020-11-01T00:00:00Z 时间的偏移量。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kafka-consumer-groups.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--group </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">my-group</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test-topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">--reset-offsets </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--to-datetime</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2020</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-11-01T00:00:00Z</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --execute</span></span></code></pre></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li>[1] View and reset consumer group offsets: <a href="https://developer.aiven.io/docs/products/kafka/howto/viewing-resetting-offset" target="_blank" rel="noreferrer">https://developer.aiven.io/docs/products/kafka/howto/viewing-resetting-offset</a></li><li>[2] How to change or reset consumer offset in Kafka: <a href="https://www.hadoopinrealworld.com/how-to-change-or-reset-consumer-offset-in-kafka/" target="_blank" rel="noreferrer">https://www.hadoopinrealworld.com/how-to-change-or-reset-consumer-offset-in-kafka/</a></li></ul>`,31))])}const w=k(y,[["render",f]]);export{O as __pageData,w as default};

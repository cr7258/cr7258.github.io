import{_ as t}from"./chunks/ArticleMetadata.CBANxfkh.js";import{_ as e,C as r,c as F,o as h,k,G as d,P as g,a as y,w as D,b as o,e as C}from"./chunks/framework.BhFhJsV2.js";import"./chunks/md5.Ek22RXBH.js";const b=JSON.parse('{"title":"为 Kubernetes 提供智能的 LLM 推理路由：Gateway API Inference Extension 深度解析","description":"","frontmatter":{"title":"为 Kubernetes 提供智能的 LLM 推理路由：Gateway API Inference Extension 深度解析","author":"Se7en","date":"2025/04/06 22:30","categories":["AI"],"tags":["AI","Gateway","Inference"]},"headers":[],"relativePath":"blogs/original/2025/14-gateway-api-inference-extension.md","filePath":"blogs/original/2025/14-gateway-api-inference-extension.md","lastUpdated":1744262515000}'),c={name:"blogs/original/2025/14-gateway-api-inference-extension.md"};function A(i,s,B,u,m,E){const l=t,p=r("ClientOnly");return h(),F("div",null,[s[0]||(s[0]=k("h1",{id:"为-kubernetes-提供智能的-llm-推理路由-gateway-api-inference-extension-深度解析",tabindex:"-1"},[y("为 Kubernetes 提供智能的 LLM 推理路由：Gateway API Inference Extension 深度解析 "),k("a",{class:"header-anchor",href:"#为-kubernetes-提供智能的-llm-推理路由-gateway-api-inference-extension-深度解析","aria-label":'Permalink to "为 Kubernetes 提供智能的 LLM 推理路由：Gateway API Inference Extension 深度解析"'},"​")],-1)),d(p,null,{default:D(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(h(),o(l,{key:0,article:i.$frontmatter},null,8,["article"])):C("",!0)]}),_:1}),s[1]||(s[1]=g(`<p>现代生成式 AI 和大语言模型（LLM）服务给 Kubernetes 带来了独特的流量路由挑战。与典型的短时、无状态 Web 请求不同，LLM 推理会话通常是长时运行、资源密集且部分有状态的。例如，一个基于 GPU 的模型服务器可能同时维护多个活跃的推理会话，并维护内存中的 token 缓存。</p><p>传统的负载均衡器多基于 HTTP 路径或轮询调度，缺乏处理此类工作负载所需的专业能力。这些方案无法识别模型标识或请求的重要性（例如交互式对话请求与批处理作业之间的区别）。企业往往采用临时拼凑的方式应对，但缺乏统一标准的解决方案。</p><p>为了解决这一问题，<a href="https://gateway-api-inference-extension.sigs.k8s.io/" target="_blank" rel="noreferrer">Gateway API Inference Extension</a> 在现有 <a href="https://gateway-api.sigs.k8s.io/" target="_blank" rel="noreferrer">Gateway API</a> 的基础上，添加了针对推理任务的专属路由能力，同时保留了 Gateways 和 HTTPRoutes 等人们熟悉的模型。通过为现有网关添加这一扩展，可以将其转变为“推理网关”（Inference Gateway），帮助用户以“模型即服务”的方式自托管生成式 AI 模型或 LLM。</p><p>Gateway API Inference Extension 可将支持 <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_proc_filter" target="_blank" rel="noreferrer">ext-proc</a> 的代理或网关（如 Envoy Gateway、kGateway 或 GKE Gateway）升级为推理网关，支持推理平台团队在 Kubernetes 上自建大语言模型服务。</p><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/202504101028179.png" alt=""></p><h2 id="主要特性" tabindex="-1">主要特性 <a class="header-anchor" href="#主要特性" aria-label="Permalink to &quot;主要特性&quot;">​</a></h2><p>Gateway API Inference Extension 提供了以下关键特性：</p><ul><li><strong>模型感知路由</strong>：与传统仅基于请求路径进行路由的方式不同，Gateway API Inference Extension 支持根据模型名称进行路由。这一能力得益于网关实现（如 Envoy Proxy）对生成式 AI 推理 API 规范（如 OpenAI API）的支持。该模型感知路由能力同样适用于基于 LoRA（Low-Rank Adaptation）微调的模型。</li><li><strong>服务优先级</strong>：Gateway API Inference Extension 支持为模型指定服务优先级。例如，可为在线对话类任务（对延迟较为敏感）的模型设定更高的 criticality，而对延迟容忍度更高的任务（如摘要生成）的模型则设定较低的优先级。</li><li><strong>模型版本发布</strong>：Gateway API Inference Extension 支持基于模型名称进行流量拆分，从而实现模型版本的渐进式发布与灰度上线。</li><li><strong>推理服务的可扩展性</strong>：Gateway API Inference Extension 定义了一种可扩展模式，允许用户根据自身需求扩展推理服务，实现定制化的路由能力，以应对默认方案无法满足的场景。</li><li><strong>面向推理的可定制负载均衡</strong>：Gateway API Inference Extension 提供了一种专为推理优化的可定制负载均衡与请求路由模式，并在实现中提供了基于模型服务器实时指标的模型端点选择（model endpoint picking）机制。该机制可替代传统负载均衡方式，被称为“模型服务器感知”的智能负载均衡。实践表明，它能够有效降低推理延迟并提升集群中 GPU 的利用率。</li></ul><h2 id="核心-crd" tabindex="-1">核心 CRD <a class="header-anchor" href="#核心-crd" aria-label="Permalink to &quot;核心 CRD&quot;">​</a></h2><p>Gateway API Inference Extension 定义了两个核心 CRD：<a href="https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencepool/" target="_blank" rel="noreferrer">InferencePool</a> 和 <a href="https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencemodel/" target="_blank" rel="noreferrer">InferenceModel</a>。</p><h3 id="inferencepool" tabindex="-1">InferencePool <a class="header-anchor" href="#inferencepool" aria-label="Permalink to &quot;InferencePool&quot;">​</a></h3><p>InferencePool 表示一组专注于 AI 推理的 Pod，同时定义了用于路由到这些 Pod 的扩展配置。在 Gateway API 的资源模型中，InferencePool 被视为一种 “Backend” 资源。实际上，它可以用来替代传统的 Kubernetes Service，作为下游服务的目标。</p><p>虽然 InferencePool 在某些方面与 Service 类似（比如选择 Pod 并指定端口），但它提供了专门面向推理场景的增强能力。InferencePool 通过 <code>extensionRef</code> 字段指向一个 EndPoint Picker 来管理推理感知的端点选择，从而根据实时指标（例如请求队列深度和 GPU 内存可用性）做出智能路由决策。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferencePool</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetPortNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 选择运行 LLM 服务的 Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  extensionRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指向 EndPoint Picker</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span></code></pre></div><h3 id="inferencemodel" tabindex="-1">InferenceModel <a class="header-anchor" href="#inferencemodel" aria-label="Permalink to &quot;InferenceModel&quot;">​</a></h3><p>InferenceModel 表示某个推理模型或适配器及其相关配置。该资源用于定义模型的重要性等级（criticality），从而支持基于优先级的请求调度。</p><p>此外，InferenceModel 还支持将用户请求中的“模型名称”平滑地映射到一个或多个后端实际模型名称，便于进行版本管理、灰度发布或适配不同模型格式。多个 InferenceModel 可以关联到同一个 InferencePool 上，从而构建出一个灵活且可扩展的模型路由体系。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferenceModel</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  modelName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 用户请求中的模型名称</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  criticality</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Standard</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 模型重要性等级</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  poolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 多个 InferenceModel 可以关联到同一个 InferencePool 上</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetModels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指定后端实际模型名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review-1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span></span></code></pre></div><h2 id="相关组件" tabindex="-1">相关组件 <a class="header-anchor" href="#相关组件" aria-label="Permalink to &quot;相关组件&quot;">​</a></h2><h3 id="endpoint-picker-epp" tabindex="-1">EndPoint Picker (EPP) <a class="header-anchor" href="#endpoint-picker-epp" aria-label="Permalink to &quot;EndPoint Picker (EPP)&quot;">​</a></h3><p><a href="https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/pkg/epp" target="_blank" rel="noreferrer">EndPoint Picker (EPP)</a> 是专为 AI 推理场景设计的智能流量调度组件。EPP 实现了 Envoy 的 <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_proc_filter" target="_blank" rel="noreferrer">ext-proc</a>，在 Envoy 转发流量之前，它会先通过 gRPC 请求 EPP，EPP 会指示 Envoy 将请求路由到哪个具体的 Pod。</p><p>EPP 主要实现以下核心功能：</p><h4 id="_1-端点选择" tabindex="-1">1. 端点选择 <a class="header-anchor" href="#_1-端点选择" aria-label="Permalink to &quot;1. 端点选择&quot;">​</a></h4><p>EPP 的首要职责是从 InferencePool 中挑选一个合适的 Pod 作为请求的目标：</p><ul><li>每个 EPP 实例只服务一个 InferencePool（每个 InferencePool 需部署一个 EPP 实例）。</li><li>它根据 InferencePool 的 <code>Selector</code> 字段，从标记为“就绪”的 Pod 中选择目标。</li><li>请求中的 <code>ModelName</code> 必须匹配绑定该 InferencePool 的某个 <code>InferenceModel</code>。</li><li>若找不到匹配的 <code>ModelName</code>，则返回错误响应给网关代理（如 Envoy）。</li></ul><h4 id="_2-流量拆分与模型名重写" tabindex="-1">2. 流量拆分与模型名重写 <a class="header-anchor" href="#_2-流量拆分与模型名重写" aria-label="Permalink to &quot;2. 流量拆分与模型名重写&quot;">​</a></h4><p>EPP 支持灰度发布和模型版本管理：</p><ul><li>通过 <code>InferenceModel</code> 中的配置，实现不同模型版本（如 LoRA 适配器）的流量按比例分配。</li><li>将用户请求中的模型名（<code>ModelName</code>）重写为真实后端模型的名称，支持灵活映射。</li></ul><h4 id="_3-可观测性" tabindex="-1">3. 可观测性 <a class="header-anchor" href="#_3-可观测性" aria-label="Permalink to &quot;3. 可观测性&quot;">​</a></h4><p>EPP 还负责生成与推理流量相关的监控指标：</p><ul><li>提供基于 <code>InferenceModel</code> 的统计数据。</li><li>这些指标可以细化到实际使用的后端模型，方便监控和调优。</li></ul><h3 id="dynamic-lora-adapter-sidecar" tabindex="-1">Dynamic LORA Adapter Sidecar <a class="header-anchor" href="#dynamic-lora-adapter-sidecar" aria-label="Permalink to &quot;Dynamic LORA Adapter Sidecar&quot;">​</a></h3><p><a href="https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/tools/dynamic-lora-sidecar" target="_blank" rel="noreferrer">Dynamic LORA Adapter Sidecar</a> 是一个基于 sidecar 的工具，用于将新的 LoRA 适配器部署到一组正在运行的 vLLM 模型服务器。用户将 sidecar 与 vLLM 服务器一起部署，并通过 ConfigMap 指定希望配置的 LoRA 适配器。sidecar 监视 ConfigMap，并向 vLLM 容器发送加载或卸载请求，以执行用户的配置意图。</p><p>这里顺便再解释一下什么是 LoRA：</p><p>LoRA（Low-Rank Adaptation，低秩自适应）适配器是一种高效微调大模型的技术，它通过在预训练模型的特定层旁添加小型可训练的低秩矩阵，仅更新少量参数即可适配新任务，显著降低计算和存储成本。其核心作用包括：动态加载不同任务适配器实现多任务切换，以及保持原模型权重不变的同时提升微调效率，适用于个性化模型定制和资源受限场景。</p><h2 id="请求流程" tabindex="-1">请求流程 <a class="header-anchor" href="#请求流程" aria-label="Permalink to &quot;请求流程&quot;">​</a></h2><p>为了说明这一切是如何结合在一起的，让我们通过一个请求示例来说明：</p><ol><li>客户端向推理网关发送请求。</li><li>请求到达推理网关后，网关根据 HTTPRoute 的匹配规则将请求路由到相应的 InferencePool。对于 Envoy 支持的 L7 路由器（如 kgateway 或 Istio），通常会通过路由策略和负载均衡来选择请求的目标端点。</li><li>但是对于 InferencePool，请求会首先发送到一个专门的扩展组件——EndPoint Picker (EPP)。EPP 会根据来自 LLM 本身的指标来选择合适的后端 LLM 端点。</li><li>当请求到达 EPP 后，EPP 会从请求正文中提取 modelName。识别出 modelName 后，EPP 会与可用的 InferenceModel 对象的 modelName 字段进行对比，确定相应的后端模型或 LoRA 适配器。例如，若 EPP 检测到的模型名称为 <code>food-review</code>，它会找到匹配的 InferenceModel，并将请求路由到适当的端点，如 <code>food-review-1</code> 或 <code>food-review-2</code>。</li><li>EPP 定义了一系列过滤器，用于选择特定模型对应的端点。它会定期查询各个 LLM Pod 的相关指标（如队列长度、KV 缓存使用情况等），从而选择最适合处理当前请求的 Pod。</li><li>EPP 选定最佳 Pod 后，会将其返回给推理网关。</li><li>推理网关将请求路由到 EPP 选择的 Pod。</li></ol><p><img src="https://chengzw258.oss-cn-beijing.aliyuncs.com/Article/202504101124494.png" alt=""></p><h2 id="实验" tabindex="-1">实验 <a class="header-anchor" href="#实验" aria-label="Permalink to &quot;实验&quot;">​</a></h2><h3 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h3><p>准备一个 GPU Kubernetes 集群，可以参考我之前写的这篇文章快速搭建：<a href="https://mp.weixin.qq.com/s/TNXrDr59wxcAZF9MhUJGjw" target="_blank" rel="noreferrer">一键部署 GPU Kind 集群，体验 vLLM 极速推理</a>。本实验运行的模型是 <code>meta-llama/Llama-3.1-8B-Instruct</code>，对 GPU 的性能有一定要求，我是用 A100 的 GPU 进行实验的。</p><p>本实验使用的资源文件可以在 Github 上找到：<a href="https://github.com/cr7258/hands-on-lab/tree/main/gateway/gateway-api-inference-extension/get-started" target="_blank" rel="noreferrer">https://github.com/cr7258/hands-on-lab/tree/main/gateway/gateway-api-inference-extension/get-started</a></p><h3 id="创建-hugging-face-token" tabindex="-1">创建 Hugging Face Token <a class="header-anchor" href="#创建-hugging-face-token" aria-label="Permalink to &quot;创建 Hugging Face Token&quot;">​</a></h3><p>需要先在 <a href="https://huggingface.co/settings/token" target="_blank" rel="noreferrer">Hugging Face</a> 创建一个 Token，并且申请 <a href="https://huggingface.co/meta-llama/Llama-3.1-8B" target="_blank" rel="noreferrer">meta-llama/Llama-3.1-8B</a> 模型的使用许可，注意填写信息的时候国家不要选中国，否则会被秒拒。</p><p>然后创建一个 Secret，将 Token 存储在其中。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> generic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hf-token</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --from-literal=token=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&lt;your-huggingface-token&gt;&quot;</span></span></code></pre></div><h3 id="部署-vllm" tabindex="-1">部署 vLLM <a class="header-anchor" href="#部署-vllm" aria-label="Permalink to &quot;部署 vLLM&quot;">​</a></h3><p>通过 vLLM 部署推理服务，默认配置为一个副本。如果 GPU 资源充足，可以增加副本数量。同时，配置了 lora-adapter-syncer 作为 sidecar 容器，根据 Configmap 中的配置动态管理 LoRA 适配器的加载与卸载。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 01-gpu-deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;vllm/vllm-openai:latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          imagePullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          command</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;python3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;-m&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;vllm.entrypoints.openai.api_server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          args</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--model&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;meta-llama/Llama-3.1-8B-Instruct&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--tensor-parallel-size&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--port&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8000&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--max-num-seq&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;1024&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--compilation-config&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--enable-lora&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--max-loras&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--max-lora-rank&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;--max-cpu-loras&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;12&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          env</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            # Enabling LoRA support temporarily disables automatic v1, we want to force it on</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            # until 0.8.3 vLLM is released.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">VLLM_USE_V1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">PORT</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8000&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HUGGING_FACE_HUB_TOKEN</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                secretKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">hf-token</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">VLLM_ALLOW_RUNTIME_LORA_UPDATING</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          lifecycle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            preStop</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              exec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">               command</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">               - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/usr/bin/sleep</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">               - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;30&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          livenessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              scheme</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            successThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            failureThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            timeoutSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              scheme</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            successThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            failureThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            timeoutSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          startupProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            failureThreshold</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">600</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              scheme</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            limits</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              nvidia.com/gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            requests</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              nvidia.com/gpu</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          volumeMounts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/dev/shm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">shm</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">adapters</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/adapters&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      initContainers</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">lora-adapter-syncer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          tty</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">us-central1-docker.pkg.dev/k8s-staging-images/gateway-api-inference-extension/lora-syncer:main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          restartPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          imagePullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          env</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">DYNAMIC_LORA_ROLLOUT_CONFIG</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/config/configmap.yaml&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          volumeMounts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># DO NOT USE subPath, dynamic configmap updates don&#39;t work on subPaths</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">config-volume</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            mountPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:  </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      restartPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      enableServiceLinks</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      terminationGracePeriodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">130</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">data</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          emptyDir</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">shm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          emptyDir</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            medium</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Memory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">adapters</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          emptyDir</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">config-volume</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          configMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  configmap.yaml</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    vLLMLoRAConfig:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      name: vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      port: 8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      defaultBaseModel: meta-llama/Llama-3.1-8B-Instruct</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      ensureExist:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        models:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          - id: food-review-1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            source: Kawon/llama3.1-food-finetune_v14_r8</span></span></code></pre></div><p>等待 vLLM 容器启动成功，如果一切正常可以看到如下日志：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vllm-llama3-8b-instruct-545c578498-47wt6</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Defaulted</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> container</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;vllm&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vllm,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lora-adapter-syncer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (init)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:39</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [__init__.py:239] Automatically detected platform cuda.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">WARNING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:44</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [api_server.py:759] LoRA dynamic loading &amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">unloading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enabled</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> This</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> should</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ONLY</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> used</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> local</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> development!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:44</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [api_server.py:981] vLLM API server version 0.8.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:44</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [api_server.py:982] args: Namespace(host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8000</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> uvicorn_log_level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;info&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> disable_uvicorn_access_log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> allow_credentials</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> allowed_origins</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[&#39;*&#39;],</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> allowed_methods</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[&#39;*&#39;],</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> allowed_headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[&#39;*&#39;],</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lora_modules</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> prompt_adapters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> chat_template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> chat_template_content_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;auto&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> response_role</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;assistant&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ssl_keyfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ssl_certfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ssl_ca_certs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> enable_ssl_refresh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ssl_cert_reqs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> root_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> middleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[],</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> return_tokens_as_token_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> disable_frontend_multiprocessing</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> enable_request_id_headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> enable_auto_tool_choice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tool_call_parser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tool_parser_plugin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;meta-llama/Llama-3.1-8B-Instruct&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;auto&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tokenizer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> hf_config_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> skip_tokenizer_init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> revision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> code_revision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tokenizer_revision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tokenizer_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;auto&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> trust_remote_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> allowed_local_media_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> download_dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> load_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;auto&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> config_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ConfigFormat.AUTO:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> &#39;auto&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&gt;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dtype=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kv_cache_dtype=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_model_len=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> guided_decoding_backend=&#39;xgrammar&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logits_processor_pattern=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model_impl=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> distributed_executor_backend=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pipeline_parallel_size=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tensor_parallel_size=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_expert_parallel=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_parallel_loading_workers=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ray_workers_use_nsight=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> block_size=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_prefix_caching=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_sliding_window=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use_v2_block_manager=True,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> num_lookahead_slots=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seed=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> swap_space=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cpu_offload_gb=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gpu_memory_utilization=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.9</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> num_gpu_blocks_override=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_num_batched_tokens=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_num_partial_prefills=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_long_partial_prefills=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> long_prefill_token_threshold=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_num_seqs=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_logprobs=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">20</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_log_stats=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> quantization=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rope_scaling=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rope_theta=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hf_overrides=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enforce_eager=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_seq_len_to_capture=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8192</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_custom_all_reduce=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tokenizer_pool_size=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tokenizer_pool_type=&#39;ray&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tokenizer_pool_extra_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> limit_mm_per_prompt=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mm_processor_kwargs=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_mm_preprocessor_cache=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_lora=True,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_lora_bias=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_loras=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_lora_rank=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lora_extra_vocab_size=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lora_dtype=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> long_lora_scaling_factors=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_cpu_loras=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fully_sharded_loras=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_prompt_adapter=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_prompt_adapters=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_prompt_adapter_token=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> device=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> num_scheduler_steps=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use_tqdm_on_load=True,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> multi_step_stream_outputs=True,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scheduler_delay_factor=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_chunked_prefill=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_model=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_model_quantization=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> num_speculative_tokens=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_disable_mqa_scorer=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_draft_tensor_parallel_size=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_max_model_len=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> speculative_disable_by_batch_size=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ngram_prompt_lookup_max=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ngram_prompt_lookup_min=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> spec_decoding_acceptance_method=&#39;rejection_sampler&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> typical_acceptance_sampler_posterior_threshold=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> typical_acceptance_sampler_posterior_alpha=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_logprobs_during_spec_decoding=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model_loader_extra_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ignore_patterns=[],</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> preemption_mode=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> served_model_name=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> qlora_adapter_name_or_path=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> show_hidden_metrics_for_version=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> otlp_traces_endpoint=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> collect_detailed_traces=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_async_output_proc=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scheduling_policy=&#39;fcfs&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> scheduler_cls=&#39;vllm.core.scheduler.Scheduler&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> override_neuron_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> override_pooler_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> compilation_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kv_transfer_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> worker_cls=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> worker_extension_cls=&#39;&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> generation_config=&#39;auto&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> override_generation_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_sleep_mode=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculate_kv_scales=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> additional_config=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_reasoning=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reasoning_parser=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_cascade_attn=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_log_requests=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> max_log_len=None,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable_fastapi_docs=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_prompt_tokens_details=False,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> enable_server_load_tracking=False</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:51</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [config.py:585] This model supports multiple tasks: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;classify&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;generate&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;embed&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;reward&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;score&#39;}.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Defaulting</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;generate&#39;.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">WARNING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:51</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [arg_utils.py:1859] Detected VLLM_USE_V1=1 with LORA. Usage should be considered experimental. Please report any issues on Github.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:51</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [config.py:1697] Chunked prefill is enabled with max_num_batched_tokens=2048.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">WARNING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:51</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [config.py:2381] LoRA with chunked prefill is still experimental and may be unstable.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:53</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [core.py:54] Initializing a V1 LLM engine (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">v0.8.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) with config: model=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;meta-llama/Llama-3.1-8B-Instruct&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, speculative_config=None, tokenizer=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;meta-llama/Llama-3.1-8B-Instruct&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, override_neuron_config=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=131072, download_dir=None, load_format=LoadFormat.AUTO, tensor_parallel_size=1, pipeline_parallel_size=1, disable_custom_all_reduce=False, quantization=None, enforce_eager=False, kv_cache_dtype=auto,  device_config=cuda, decoding_config=DecodingConfig(guided_decoding_backend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;xgrammar&#39;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> reasoning_backend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> observability_config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ObservabilityConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(show_hidden_metrics</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> otlp_traces_endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> collect_model_forward_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> collect_model_execute_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> seed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> served_model_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">meta-llama/Llama-3.1-8B-Instruct,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> num_scheduler_steps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> multi_step_stream_outputs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> enable_prefix_caching</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> chunked_prefill_enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> use_async_output_proc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> disable_mm_preprocessor_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">False,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> mm_processor_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pooler_config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">None,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> compilation_config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">{&quot;level&quot;:3,&quot;custom_ops&quot;:[&quot;none&quot;],&quot;splitting_ops&quot;:[&quot;vllm.unified_attention&quot;,&quot;vllm.unified_attention_with_output&quot;],&quot;use_inductor&quot;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,&quot;compile_sizes&quot;:[],&quot;use_cudagraph&quot;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,&quot;cudagraph_num_of_warmups&quot;:1,&quot;cudagraph_capture_sizes&quot;:[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">512</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,504,496,488,480,472,464,456,448,440,432,424,416,408,400,392,384,376,368,360,352,344,336,328,320,312,304,296,288,280,272,264,256,248,240,232,224,216,208,200,192,184,176,168,160,152,144,136,128,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,4,2,1],&quot;max_capture_size&quot;:512}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">WARNING</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:54</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [utils.py:2321] Methods determine_num_available_blocks,device_config,get_cache_block_size_bytes,initialize_cache not implemented </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">vllm.v1.worker.gpu_worker.Worker object at 0x73d836b269c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">0&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [parallel_state.py:954] rank 0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> world size 1 is assigned as DP rank 0, PP rank 0, TP rank 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [cuda.py:220] Using Flash Attention backend on V1 engine.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [gpu_model_runner.py:1174] Starting to load model meta-llama/Llama-3.1-8B-Instruct...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [topk_topp_sampler.py:53] Using FlashInfer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> top-p &amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">top-k</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sampling.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:51:55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [weight_utils.py:265] Using model weights format [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;*.safetensors&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:52:51</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [weight_utils.py:281] Time spent downloading weights </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> meta-llama/Llama-3.1-8B-Instruct: 55.301468 seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 0/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:00&lt;?, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">?it/s]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  25</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 1/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:00&lt;00:02,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.25</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">it/s]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  50</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 2/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:01&lt;00:01,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.72</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">it/s]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  75</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 3/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:01&lt;00:00,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.50</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">it/s]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 4/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:02&lt;00:00,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.25</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">it/s]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> safetensors</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> checkpoint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> shards:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Completed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 4/4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [00:02&lt;00:00,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.33</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">it/s]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:52:54</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [loader.py:447] Loading weights took 3.27 seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:52:54</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [punica_selector.py:18] Using PunicaWrapperGPU.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:52:54</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [gpu_model_runner.py:1186] Model loading took 15.1749 GB and 59.268527 seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:53:07</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [backends.py:415] Using cache directory: /root/.cache/vllm/torch_compile_cache/253772ede5/rank_0_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> vLLM</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;s torch.compile</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:53:07 [backends.py:425] Dynamo bytecode transform time: 12.60 s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:53:13 [backends.py:132] Cache the graph of shape None for later use</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:53:53 [backends.py:144] Compiling a graph for general shape takes 44.37 s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:54:19 [monitor.py:33] torch.compile takes 56.97 s in total</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:54:20 [kv_cache_utils.py:566] GPU KV cache size: 148,096 tokens</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:54:20 [kv_cache_utils.py:569] Maximum concurrency for 131,072 tokens per request: 1.13x</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:55:41 [gpu_model_runner.py:1534] Graph capturing finished in 81 secs, took 0.74 GiB</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">INFO 04-05 05:55:42 [core.py:151] init engine (profile, create kv cache, warmup model) took 167.44 seconds</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">WARNING 04-05 05:55:42 [config.py:1028] Default sampling parameters have been overridden by the model&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">s Hugging Face generation config recommended from the model creator. If this is not intended, please relaunch vLLM instance with </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--generation-config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vllm\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [serving_chat.py:115] Using default chat sampling params from model: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;temperature&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;top_p&#39;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.9</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [serving_completion.py:61] Using default completion sampling params from model: {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;temperature&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;top_p&#39;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.9</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [api_server.py:1028] Starting vLLM API server on http://0.0.0.0:8000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:26] Available routes are:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /openapi.json, Methods: GET, HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /docs, Methods: GET, HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /docs/oauth2-redirect, Methods: GET, HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /redoc, Methods: GET, HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /health, Methods: GET</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /load, Methods: GET</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /ping, Methods: GET, POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /tokenize, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /detokenize, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/models, Methods: GET</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /version, Methods: GET</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/chat/completions, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/completions, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/embeddings, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /pooling, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /score, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/score, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/audio/transcriptions, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /rerank, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/rerank, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v2/rerank, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /invocations, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/load_lora_adapter, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 04</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:42</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [launcher.py:34] Route: /v1/unload_lora_adapter, Methods: POST</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     Started</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [1]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     Waiting</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> application</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> startup.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     Application</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> startup</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> complete.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">     10.244</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.1:33920</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;GET /health HTTP/1.1&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">INFO:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">     10.244</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.1.1:33922</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;GET /health HTTP/1.1&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span></code></pre></div><p>查看 lora-adapter-syncer sidecar 容器的日志，可以看到加载了 <code>food-review-1</code> 适配器。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:56</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> WARNING</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:266</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  skipped</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> adapters</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> found</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> both</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ensureExist</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ensureNotExist</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:56</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:271</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:56</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:218</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  food-review-1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> already</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> present</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:57</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:276</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapters</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unload</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:55:57</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:310</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Waiting</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> before</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> next</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconciliation...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:56:02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:314</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Periodic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconciliation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> triggered</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:56:02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:255</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  reconciling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stored</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /config/configmap.yaml</span></span></code></pre></div><h3 id="安装-inference-extension-crd" tabindex="-1">安装 Inference Extension CRD <a class="header-anchor" href="#安装-inference-extension-crd" aria-label="Permalink to &quot;安装 Inference Extension CRD&quot;">​</a></h3><p>安装 InferencePool 和 InferenceModel 这两个 CRD。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v0.2.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/kubernetes-sigs/gateway-api-inference-extension/releases/download/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/manifests.yaml</span></span></code></pre></div><h3 id="部署-inferencemodel" tabindex="-1">部署 InferenceModel <a class="header-anchor" href="#部署-inferencemodel" aria-label="Permalink to &quot;部署 InferenceModel&quot;">​</a></h3><p>部署 InferenceModel，将用户请求 <code>food-review</code> 模型的流量转发到示例模型服务器的 <code>food-review-1</code> LoRA 适配器。InferenceModel 通过 <code>poolRef</code> 关联 InferencePool（将在下一小节创建）。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 02-inferencemodel.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferenceModel</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  modelName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 用户请求中的模型名称</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  criticality</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Standard</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 模型重要性等级</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  poolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 多个 InferenceModel 可以关联到同一个 InferencePool 上</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetModels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指定后端实际模型名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review-1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span></span></code></pre></div><h3 id="部署-inferencepool-和-epp" tabindex="-1">部署 InferencePool 和 EPP <a class="header-anchor" href="#部署-inferencepool-和-epp" aria-label="Permalink to &quot;部署 InferencePool 和 EPP&quot;">​</a></h3><p>部署 InferencePool，通过 <code>selector</code> 选择运行 LLM 服务的 Pod，并通过 <code>extensionRef</code> 关联 EPP。EPP 会基于实时指标（如请求队列深度和 GPU 可用内存）做出智能路由决策。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 03-inferencepool-resources.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferencePool</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetPortNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 选择运行 LLM 服务的 Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  extensionRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指向 EndPoint Picker</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">TCP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9002</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9002</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      appProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ClusterIP</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">      # Conservatively, this timeout should mirror the longest grace period of the pods within the pool</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      terminationGracePeriodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">130</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">epp</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">us-central1-docker.pkg.dev/k8s-staging-images/gateway-api-inference-extension/epp:main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        imagePullPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        args</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-poolName</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;vllm-llama3-8b-instruct&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-v</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;4&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">--zap-encoder</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-grpcPort</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;9002&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-grpcHealthPort</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;9003&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">USE_STREAMING</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9002</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9003</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">metrics</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9090</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        livenessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          grpc</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9003</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference-extension</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          grpc</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9003</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference-extension</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">pod-read</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;inference.networking.x-k8s.io&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;inferencemodels&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;watch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;pods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;watch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;inference.networking.x-k8s.io&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;inferencepools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;watch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;discovery.k8s.io&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;endpointslices&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;get&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;watch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">authentication.k8s.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">tokenreviews</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">create</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">authorization.k8s.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  resources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">subjectaccessreviews</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  verbs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">create</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ClusterRoleBinding</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">pod-read-binding</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">subjects</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ServiceAccount</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">roleRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">pod-read</span></span></code></pre></div><h3 id="部署推理网关" tabindex="-1">部署推理网关 <a class="header-anchor" href="#部署推理网关" aria-label="Permalink to &quot;部署推理网关&quot;">​</a></h3><p>当前支持 Gateway API Inference Extension 的网关有 <a href="https://kgateway.dev/" target="_blank" rel="noreferrer">Kgateway</a>，<a href="https://gateway.envoyproxy.io/" target="_blank" rel="noreferrer">Envoy AI Gateway</a> 等，完整的列表可以参考 <a href="https://gateway-api-inference-extension.sigs.k8s.io/implementations" target="_blank" rel="noreferrer">Implementations</a>。</p><p>本文将会以 Kgateway 为例进行演示。</p><p>首先安装 Kgateway 相关的 CRD。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">KGTW_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v2.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --create-namespace</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kgateway-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $KGTW_VERSION </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kgateway-crds</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> oci://cr.kgateway.dev/kgateway-dev/charts/kgateway-crds</span></span></code></pre></div><p>然后安装 Kgateway，设置 <code>inferenceExtension.enabled=true</code> 参数启用推理扩展。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> upgrade</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kgateway-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $KGTW_VERSION </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kgateway</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> oci://cr.kgateway.dev/kgateway-dev/charts/kgateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inferenceExtension.enabled=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span></code></pre></div><p>接着创建 Gateway，<code>gatewayClassName</code> 关联到 Kgateway。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 04-gateway.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gateway.networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Gateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference-gateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  gatewayClassName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kgateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  listeners</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP</span></span></code></pre></div><p>确认网关已分配 IP 地址并报告 <code>Programmed=True</code> 状态。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inference-gateway</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                CLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      ADDRESS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      PROGRAMMED</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">inference-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   kgateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   172.18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.0.4</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   True</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">         16</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">s</span></span></code></pre></div><p>部署 HTTPRoute，将流量路由到 InferencePool。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 05-httproute.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gateway.networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTPRoute</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm-route</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  parentRefs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gateway.networking.k8s.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Gateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference-gateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">backendRefs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferencePool</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8000</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # Remove when https://github.com/kgateway-dev/kgateway/issues/10987 is fixed.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    matches</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">PathPrefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        value</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    timeouts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      request</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">300s</span></span></code></pre></div><p>确认 HTTPRoute 状态条件包含 <code>Accepted=True</code> 和 <code>ResolvedRefs=True</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kubectl get httproute llm-route -o yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gateway.networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTPRoute</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">...</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  parents</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">conditions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">lastTransitionTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2025-04-05T13:04:35Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      message</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      observedGeneration</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      reason</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Accepted</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      status</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;True&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Accepted</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">lastTransitionTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2025-04-05T13:06:14Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      message</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      observedGeneration</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      reason</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ResolvedRefs</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      status</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;True&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ResolvedRefs</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    controllerName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kgateway.dev/kgateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    parentRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      group</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">gateway.networking.k8s.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Gateway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference-gateway</span></span></code></pre></div><h3 id="请求验证" tabindex="-1">请求验证 <a class="header-anchor" href="#请求验证" aria-label="Permalink to &quot;请求验证&quot;">​</a></h3><p>至此，我们已完成全部配置工作，接下来可通过 curl 命令向推理网关发送请求进行测试。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">IP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get gateway/inference-gateway </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-o</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jsonpath=&#39;{.status.addresses[0].value}&#39;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \${IP}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">\${PORT}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/v1/completions</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;Content-Type: application/json&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;model&quot;: &quot;food-review&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;prompt&quot;: &quot;Write as if you were a critic: San Francisco&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;max_tokens&quot;: 100,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;temperature&quot;: 0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&#39;</span></span></code></pre></div><p>响应结果如下，可以看到模型成功处理了请求。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">date:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sat,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2025</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:18:22</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> GMT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> envoy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content-type:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> application/json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-envoy-upstream-service-time:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1785</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-went-into-resp-headers:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">transfer-encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chunked</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;choices&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;finish_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;length&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;index&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;prompt_logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;stop_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;text&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&#39;s iconic seafood restaurant, Ali&#39;s Bistro, serves a variety of seafood dishes, including sushi, sashimi, and seafood paella. How would you rate Ali&#39;s Bistro 1.0? (1 being lowest and 10 being highest)\\n### Step 1: Analyze the menu offerings\\nAli&#39;s Bistro offers a diverse range of seafood dishes, including sushi, sashimi, and seafood paella. This variety suggests that the restaurant caters to different tastes and dietary&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;created&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1743859102</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;cmpl-0046459d-d94f-43b5-b8f4-0898d8e2d50b&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;model&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;food-review-1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;object&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;text_completion&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;usage&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;completion_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens_details&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;total_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 111</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="发布新的适配器版本" tabindex="-1">发布新的适配器版本 <a class="header-anchor" href="#发布新的适配器版本" aria-label="Permalink to &quot;发布新的适配器版本&quot;">​</a></h3><p>接下来，将演示如何发布新的适配器版本。通过修改 <code>vllm-llama3-8b-instruct-adapters</code> ConfigMap，让 lora-adapter-syncer sidecar 容器加载新的适配器到 vLLM 容器。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vllm-llama3-8b-instruct-adapters</span></span></code></pre></div><p>更改 Configmap 的配置如下，增加 <code>food-review-2</code> 适配器。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  configmap.yaml</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    vLLMLoRAConfig:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      name: vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      port: 8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      defaultBaseModel: meta-llama/Llama-3.1-8B-Instruct</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      ensureExist:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        models:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - id: food-review-1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          source: Kawon/llama3.1-food-finetune_v14_r8</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        # 增加新的适配器</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - id: food-review-2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          source: Kawon/llama3.1-food-finetune_v14_r8</span></span></code></pre></div><p>新的适配器版本将实时应用于模型服务器，无需重新启动。查看 lora-adapter-syncer sidecar 容器日志，可以看到加载了 <code>food-review-2</code> 适配器。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:21</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:271</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-2,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:21</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:231</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:21</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:218</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  food-review-1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> already</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> present</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:21</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:276</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapters</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unload</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:21</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:62</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconcile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/config/configmap.yaml&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> !</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:22</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:314</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Periodic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconciliation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> triggered</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:15:22</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:255</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  reconciling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stored</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /config/configmap.yaml</span></span></code></pre></div><p>修改 InferenceModel 的配置以 Canary 的方式发布新的适配器版本。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> edit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inferencemodel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review</span></span></code></pre></div><p>将 10% 的流量路由到新的 <code>food-review-2</code> 适配器，90% 的流量路由到 <code>food-review-1</code>。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferenceModel</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  modelName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  criticality</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Standard</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  poolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetModels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review-1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">90</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review-2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10</span></span></code></pre></div><p>使用相同的 curl 命令请求多次进行测试，可以观察到 90% 的请求被路由到 <code>food-review-1</code>，10% 的请求被路由到 <code>food-review-2</code>。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \${IP}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">\${PORT}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/v1/completions</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;Content-Type: application/json&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;model&quot;: &quot;food-review&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;prompt&quot;: &quot;Write as if you were a critic: San Francisco&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;max_tokens&quot;: 100,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;temperature&quot;: 0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 发送 food-review-1 的请求，可以通过响应的 model 字段辨认</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">date:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sat,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2025</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:18:34</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> GMT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> envoy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content-type:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> application/json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-envoy-upstream-service-time:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1780</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-went-into-resp-headers:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">transfer-encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chunked</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;choices&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;finish_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;length&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;index&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;prompt_logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;stop_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;text&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&#39;s iconic seafood restaurant, Ali&#39;s Bistro, serves a variety of seafood dishes, including sushi, sashimi, and seafood paella. How would you rate Ali&#39;s Bistro 1.0? (1 being lowest and 10 being highest)\\n### Step 1: Analyze the menu offerings\\nAli&#39;s Bistro offers a diverse range of seafood dishes, including sushi, sashimi, and seafood paella. This variety suggests that the restaurant caters to different tastes and dietary&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;created&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1743859115</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;cmpl-99203056-cb12-4c8e-bae9-23c28c07cdd7&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;model&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;food-review-1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;object&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;text_completion&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;usage&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;completion_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens_details&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;total_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 111</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \${IP}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">\${PORT}</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/v1/completions</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;Content-Type: application/json&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;model&quot;: &quot;food-review&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;prompt&quot;: &quot;Write as if you were a critic: San Francisco&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;max_tokens&quot;: 100,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;temperature&quot;: 0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">HTTP/1.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">date:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sat,</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 05</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2025</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:18:38</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> GMT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> envoy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content-type:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> application/json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-envoy-upstream-service-time:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2531</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">x-went-into-resp-headers:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">transfer-encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chunked</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 发送到 food-review-2 的请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;choices&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;finish_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;length&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;index&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;prompt_logprobs&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;stop_reason&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      &quot;text&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&#39;s iconic seafood restaurant, Ali&#39;s Bistro, serves a variety of seafood dishes, including sushi, sashimi, and seafood paella. How would you rate Ali&#39;s Bistro 1.0? (1 being lowest and 10 being highest)\\n### Step 1: Analyze the menu offerings\\nAli&#39;s Bistro offers a diverse range of seafood dishes, including sushi, sashimi, and seafood paella. This variety suggests that the restaurant caters to different tastes and dietary&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;created&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1743859119</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;cmpl-6f2e2e5f-a0e7-4ee0-bd54-5b1a2ef23399&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;model&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;food-review-2&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;object&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;text_completion&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;usage&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;completion_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;prompt_tokens_details&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> null,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;total_tokens&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 111</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>确认新版本的适配器工作正常后，可以修改 InferenceModel 的配置，将 100% 的流量路由到 <code>food-review-2</code>。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">inference.networking.x-k8s.io/v1alpha2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">InferenceModel</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  modelName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  criticality</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Standard</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  poolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  targetModels</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">food-review-2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span></span></code></pre></div><p>同时修改 <code>vllm-llama3-8b-instruct-adapters</code> ConfigMap，将旧版本 <code>food-review-1</code> 移动到 <code>ensureNotExist</code> 列表中，从服务器卸载旧版本。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  configmap.yaml</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    vLLMLoRAConfig:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      name: vllm-llama3-8b-instruct-adapters</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      port: 8000</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      defaultBaseModel: meta-llama/Llama-3.1-8B-Instruct</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      ensureExist:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        models:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - id: food-review-2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          source: Kawon/llama3.1-food-finetune_v14_r8</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      ensureNotExist:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        models:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        - id: food-review-1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          source: Kawon/llama3.1-food-finetune_v14_r8</span></span></code></pre></div><p>观察 lora-adapter-syncer sidecar 容器日志，可以看到卸载了 <code>food-review-1</code> 适配器。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:53</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:271</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:53</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:218</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  food-review-2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> already</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> present</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:53</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:276</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  adapters</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unload</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:53</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:247</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  unloaded</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> food-review-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:53</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:62</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconcile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/config/configmap.yaml&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> !</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:56</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:314</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  Periodic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> reconciliation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> triggered</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2025-04-05</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:27:56</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> INFO</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sidecar.py:255</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  reconciling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> localhost:8000</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stored</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /config/configmap.yaml</span></span></code></pre></div><p>此时，所有请求都应该由新的适配器版本提供服务。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>Gateway API Inference Extension 为 Kubernetes 上的 LLM 推理服务提供了专业化的流量路由解决方案。通过模型感知路由、服务优先级和智能负载均衡等特性，它有效提高了 GPU 资源利用率，降低了推理延迟。该扩展通过 InferencePool 和 InferenceModel 两个核心 CRD，结合 EndPoint Picker 和 Dynamic LORA Adapter Sidecar 组件，实现了模型版本的灰度发布与动态 LoRA 适配器管理，为 Kubernetes 上自托管的大语言模型提供了标准化且灵活的解决方案。</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li>Gateway API Inference Extension: <a href="https://gateway-api-inference-extension.sigs.k8s.io/" target="_blank" rel="noreferrer">https://gateway-api-inference-extension.sigs.k8s.io/</a></li><li>Gateway API: <a href="https://gateway-api.sigs.k8s.io/" target="_blank" rel="noreferrer">https://gateway-api.sigs.k8s.io/</a></li><li>ext-proc: <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_proc_filter" target="_blank" rel="noreferrer">https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_proc_filter</a></li><li>InferencePool: <a href="https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencepool/" target="_blank" rel="noreferrer">https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencepool/</a></li><li>InferenceModel: <a href="https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencemodel/" target="_blank" rel="noreferrer">https://gateway-api-inference-extension.sigs.k8s.io/api-types/inferencemodel/</a></li><li>EndPoint Picker (EPP): <a href="https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/pkg/epp" target="_blank" rel="noreferrer">https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/pkg/epp</a></li><li>Dynamic LORA Adapter Sidecar: <a href="https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/tools/dynamic-lora-sidecar" target="_blank" rel="noreferrer">https://github.com/kubernetes-sigs/gateway-api-inference-extension/tree/main/tools/dynamic-lora-sidecar</a></li><li>Implementations: <a href="https://gateway-api-inference-extension.sigs.k8s.io/implementations" target="_blank" rel="noreferrer">https://gateway-api-inference-extension.sigs.k8s.io/implementations</a></li><li>Deep Dive into the Gateway API Inference Extension: <a href="https://kgateway.dev/blog/deep-dive-inference-extensions/" target="_blank" rel="noreferrer">https://kgateway.dev/blog/deep-dive-inference-extensions/</a></li><li>Smarter AI Inference Routing on Kubernetes with Gateway API Inference Extension: <a href="https://kgateway.dev/blog/smarter-ai-reference-kubernetes-gateway-api/" target="_blank" rel="noreferrer">https://kgateway.dev/blog/smarter-ai-reference-kubernetes-gateway-api/</a></li></ul>`,107))])}const q=e(c,[["render",A]]);export{b as __pageData,q as default};
